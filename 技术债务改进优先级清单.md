# 骆言项目技术债务改进优先级清单

## 🚨 高优先级 - 立即执行 (P0)

### 1. 冗余文件清理
- [ ] 删除 `src/lexer.ml.backup` (50KB备份文件)
- [ ] 清理 `src/src/lexer/` 空目录
- [ ] 检查项目中其他备份文件
- **预计时间**: 0.5天
- **风险**: 极低

### 2. Parser_expressions.ml 模块拆分
- [ ] 当前860行 → 目标<400行
- [ ] 拆分为专门的子模块:
  - `Parser_expressions_assignment.ml` - 赋值表达式
  - `Parser_expressions_logical.ml` - 逻辑表达式  
  - `Parser_expressions_arithmetic.ml` - 算术表达式
  - `Parser_expressions_function_calls.ml` - 函数调用
- **预计时间**: 3-5天
- **风险**: 中等 (需要充分测试)

## ⚠️ 中优先级 - 短期执行 (P1)

### 3. 日志器初始化统一
- [ ] 消除13个文件中的重复代码
- [ ] 创建 `Logger_utils.ml` 统一接口
- **预计时间**: 1天
- **风险**: 低

### 4. 语义分析器模块化
- [ ] `semantic.ml` 当前759行 → 目标<400行
- [ ] 分离: 类型检查、符号表管理、错误报告
- **预计时间**: 5-7天
- **风险**: 中等

### 5. 错误处理系统统一
- [ ] 合并8个错误处理相关文件的重复逻辑
- [ ] 建立统一的错误接口
- **预计时间**: 5-7天
- **风险**: 中等

## 📋 低优先级 - 长期规划 (P2)

### 6. AI模块架构重设计
- [ ] 8个AI模块总计3,366行代码需要重组
- [ ] 消除功能重叠，建立分层架构
- **预计时间**: 10-14天
- **风险**: 高

### 7. C代码生成器拆分
- [ ] `c_codegen.ml` 当前721行 → 目标<400行
- [ ] 按功能拆分：表达式生成、语句生成、类型转换
- **预计时间**: 7-10天
- **风险**: 中等

### 8. 模块依赖优化
- [ ] 减少45个文件对Ast模块的过度依赖
- [ ] 建立分层架构，减少耦合度
- **预计时间**: 7-10天
- **风险**: 高

### 9. 类型系统重组评估
- [ ] 评估9个types模块的合理性
- [ ] 可能的模块合并或重组
- **预计时间**: 5-7天
- **风险**: 中等

### 10. 命名规范全面统一
- [ ] 建立统一的命名规范文档
- [ ] 重命名不一致的模块和函数
- **预计时间**: 5-7天
- **风险**: 低

---

## 📊 当前状态指标

| 指标 | 当前值 | 目标值 | 状态 |
|------|--------|--------|------|
| 超大文件(>500行) | 6个 | 0个 | 🔴 需要改进 |
| 平均文件大小 | 259行 | <200行 | 🟡 可接受 |
| 测试覆盖率 | 1.18:1 | >1:1 | 🟢 良好 |
| 模块总数 | 68个 | 适中 | 🟢 合理 |

## 🎯 第一阶段目标 (2周内)

- [x] 完成技术债务全面分析
- [ ] 清理所有冗余文件  
- [ ] 完成Parser_expressions.ml拆分
- [ ] 统一日志器初始化模式
- [ ] 建立模块拆分最佳实践文档

**成功标准**:
- 超大文件数量从6个减少到5个
- 编译时间减少10-15%
- 代码可维护性显著提升

---
**最后更新**: 2025-07-16  
**负责人**: Claude Code AI Assistant  
**审批**: 待@UltimatePea确认