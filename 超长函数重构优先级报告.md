# 骆言项目超长函数重构优先级分析报告
============================================================

## 📊 总体优先级统计
- 分析函数总数: 61
- 🔴 关键优先级 (立即重构): 2
- 🟠 高优先级 (尽快重构): 7
- 🟡 中优先级 (计划重构): 9

## 🔴 关键优先级函数 - 立即重构
### similarity (src/error_messages_analysis.ml)
- **行数**: 181 行 (45-225)
- **类型**: unknown
- **复杂度**: 266.4 (1.47/行)
- **优先级得分**: 55
- **重构建议**:
  - 🔴 函数过长，建议拆分为多个小函数
  - 🟡 模式匹配过多，考虑使用策略模式或查找表
  - 🟡 嵌套let表达式过多，考虑提取辅助函数
  - 🟠 大量数据声明，强烈建议数据外化
  - 🛠️  异常处理较多，可考虑统一错误处理模式

### trimmed (src/poetry/data/poetry_data_loader.ml)
- **行数**: 186 行 (143-328)
- **类型**: unknown
- **复杂度**: 205.6 (1.11/行)
- **优先级得分**: 55
- **重构建议**:
  - 🔴 函数过长，建议拆分为多个小函数
  - 🟡 嵌套let表达式过多，考虑提取辅助函数
  - 🟠 大量数据声明，强烈建议数据外化
  - 🛠️  异常处理较多，可考虑统一错误处理模式

## 🟠 高优先级函数 - 尽快重构
### parsed (src/poetry/data/poetry_data_loader.ml)
- **行数**: 171 行
- **类型**: parsing
- **复杂度**: 185.8
- **主要建议**: 🔴 函数过长，建议拆分为多个小函数

### matched_branch (src/expression_evaluator.ml)
- **行数**: 138 行
- **类型**: matching
- **复杂度**: 297.7
- **主要建议**: 🔴 函数过长，建议拆分为多个小函数

### trimmed (src/poetry/data/rhyme_data_loader.ml)
- **行数**: 136 行
- **类型**: unknown
- **复杂度**: 192.1
- **主要建议**: 🔴 函数过长，建议拆分为多个小函数

### inner (src/poetry/data/poetry_data_loader.ml)
- **行数**: 179 行
- **类型**: unknown
- **复杂度**: 199.7
- **主要建议**: 🔴 函数过长，建议拆分为多个小函数

### output_ch (src/logging/log_core.ml)
- **行数**: 145 行
- **类型**: unknown
- **复杂度**: 162.1
- **主要建议**: 🔴 函数过长，建议拆分为多个小函数

### high_priority (src/unified_token_registry.ml)
- **行数**: 146 行
- **类型**: unknown
- **复杂度**: 114.0
- **主要建议**: 🔴 函数过长，建议拆分为多个小函数

### char (src/poetry/rhyme_analysis.ml)
- **行数**: 146 行
- **类型**: unknown
- **复杂度**: 135.6
- **主要建议**: 🔴 函数过长，建议拆分为多个小函数

## 📈 按函数类型统计
### unknown
- 函数数量: 51
- 平均行数: 79.6
- 平均复杂度: 1.23

### error_handling
- 函数数量: 3
- 平均行数: 81.3
- 平均复杂度: 1.08

### data_processing
- 函数数量: 2
- 平均行数: 64.5
- 平均复杂度: 1.08

### formatting
- 函数数量: 2
- 平均行数: 82.5
- 平均复杂度: 2.06

### parsing
- 函数数量: 1
- 平均行数: 171.0
- 平均复杂度: 1.09

### matching
- 函数数量: 1
- 平均行数: 138.0
- 平均复杂度: 2.16

### evaluation
- 函数数量: 1
- 平均行数: 73.0
- 平均复杂度: 1.91

## 🛠️  重构策略建议
### 立即行动 (本周)
1. 重构关键优先级函数中的数据处理函数
2. 对poetry相关模块的大型函数进行数据外化
3. 拆分evaluation模块中的超长函数

### 短期计划 (本月)
1. 重构所有100+行的高优先级函数
2. 建立统一的错误处理模式
3. 优化parser模块的函数结构

### 中长期计划 (本季度)
1. 重构所有50+行的中优先级函数
2. 建立模块化的数据处理架构
3. 完善代码质量监控机制