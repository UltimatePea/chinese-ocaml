(*
 * 词法分析器测试
 * 验证词法分析器的基本功能
 *)

使用 基础工具.工具库
使用 词法分析.词法分析器

「：测试用例结构：」
类型 测试用例 为 {
  名称: 字符串;
  输入: 字符串;
  期望词法单元数量: 整数;
}

「：基础测试用例：」
设 基础测试用例列表 为 [
  {
    名称 为 『简单整数』;
    输入 为 『42』;
    期望词法单元数量 为 2;  「：数字 + EOF：」
  };
  
  {
    名称 为 『简单字符串』;
    输入 为 『\』你好世界\『』;
    期望词法单元数量 为 2;  「：字符串 + EOF：」
  };
  
  {
    名称 为 『中文关键字』;
    输入 为 『夫 x 为 42』;
    期望词法单元数量 为 5;  「：夫 + 标识符 + 为 + 数字 + EOF：」
  };
  
  {
    名称 为 『算术表达式』;
    输入 为 『1 + 2 * 3』;
    期望词法单元数量 为 6;  「：1 + + + 2 + * + 3 + EOF：」
  };
  
  {
    名称 为 『函数定义』;
    输入 为 『函数 x -> x + 1』;
    期望词法单元数量 为 7;  「：函数 + x + -> + x + + + 1 + EOF：」
  };
]

「：运行单个测试用例：」
夫 运行测试用例 者 受 测试用例 焉 算法 乃
  打印调试信息 (『运行测试: 』 ^ 测试用例.名称);
  
  观 词法分析 测试用例.输入 『测试文件』 之 性
  | 失败 错误信息 焉 算法 乃
      打印调试信息 (『测试失败: 』 ^ 测试用例.名称 ^ 『 - 词法分析错误』);
      false
  | 成功 (词法单元列表, _) 焉 算法 乃
      设 实际数量 为 List.length 词法单元列表 在
      if 实际数量 为 测试用例.期望词法单元数量 then (
        打印调试信息 (『测试通过: 』 ^ 测试用例.名称);
        true
      ) else (
        打印调试信息 (『测试失败: 』 ^ 测试用例.名称 ^ 
                      『 - 期望 』 ^ (整数转字符串 测试用例.期望词法单元数量) ^
                      『 个词法单元，实际得到 』 ^ (整数转字符串 实际数量));
        false
      )
是谓

「：运行所有测试：」
夫 运行所有测试 者 受 () 焉 算法 乃
  打印调试信息 『开始词法分析器测试...』;
  
  设 通过数量 为 ref 0 在
  设 总数量 为 List.length 基础测试用例列表 在
  
  List.iter (夫 参数函数 者 受 测试用例 焉 算法 乃
    if 运行测试用例 测试用例 then
      通过数量 := !通过数量 + 1
  是谓) 基础测试用例列表;
  
  打印调试信息 (『测试完成: 』 ^ 
                (整数转字符串 !通过数量) ^ 『/』 ^ 
                (整数转字符串 总数量) ^ 『 测试通过』);
  
  !通过数量 为 总数量
是谓

「：主测试函数：」
夫 主函数 者 受 () 焉 算法 乃
  if 运行所有测试 () then
    打印调试信息 『所有词法分析器测试通过！』
  else
    打印调试信息 『部分词法分析器测试失败！』
是谓