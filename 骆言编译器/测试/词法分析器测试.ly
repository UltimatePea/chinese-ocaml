（*
 * 词法分析器测试
 * 验证词法分析器的基本功能
 *）

使用 基础工具.工具库
使用 词法分析.词法分析器

「：测试用例结构：」
类型 测试用例为{
  名称: 字符串;
  输入: 字符串;
  期望词法单元数量: 整数;
}

「：基础测试用例：」
设「基础测试用例列表」为(列开始 {
    名称为『简单整数』 其一 输入为『42』 其二 期望词法单元数量为2 其三 「：数字 + EOF：」
  } 其一 {
    名称为『简单字符串』 其二 输入为『\』你好世界\『』 其三 期望词法单元数量为2 其一 「：字符串 + EOF：」
  } 其二 {
    名称为『中文关键字』 其三 输入为『夫 x为42』 其一 期望词法单元数量为5 其二 「：夫 + 标识符 +为+ 数字 + EOF：」
  } 其三 {
    名称为『算术表达式』 其一 输入为『1 + 2 * 3』 其二 期望词法单元数量为6 其三 「：1 + + + 2 + * + 3 + EOF：」
  } 其一 {
    名称为『函数定义』 其二 输入为『函数 x -> x + 1』 其三 期望词法单元数量为7 其一 「：函数 + x + -> + x + + + 1 + EOF：」
  } 其二 列结束)

「：运行单个测试用例：」
夫「运行测试用例」者受 测试用例 焉算法乃
  打印调试信息 （『运行测试: 』 ^ 测试用例.名称）;

  观 词法分析 测试用例.输入 『测试文件』 之 性
  | 失败 错误信息 焉算法乃
      打印调试信息 （『测试失败: 』 ^ 测试用例.名称 ^ 『 - 词法分析错误』）;
      false
  | 成功 （词法单元列表, _） 焉算法乃
      设「实际数量」为List.length 词法单元列表 在
      if 实际数量为测试用例.期望词法单元数量 then （
        打印调试信息 （『测试通过: 』 ^ 测试用例.名称）;
        true
      ） else （
        打印调试信息 （『测试失败: 』 ^ 测试用例.名称 ^
                      『 - 期望 』 ^ （整数转字符串 测试用例.期望词法单元数量） ^
                      『 个词法单元，实际得到 』 ^ （整数转字符串 实际数量））;
        false
      ）
是谓

「：运行所有测试：」
夫「运行所有测试」者受 （） 焉算法乃
  打印调试信息 『开始词法分析器测试...』;

  设「通过数量」为ref 0 在
  设「总数量」为List.length 基础测试用例列表 在

  List.iter （夫「参数函数」者受 测试用例 焉算法乃
    if 运行测试用例 测试用例 then
      通过数量 :=!通过数量 + 1
  是谓） 基础测试用例列表;

  打印调试信息 （『测试完成: 』 ^
                （整数转字符串 !通过数量） ^ 『/』 ^
                （整数转字符串 总数量） ^ 『 测试通过』）;

  !通过数量为总数量
是谓

「：主测试函数：」
夫「主函数」者受 （） 焉算法乃
  if 运行所有测试 （） then
    打印调试信息 『所有词法分析器测试通过！』
  else
    打印调试信息 『部分词法分析器测试失败！』
是谓