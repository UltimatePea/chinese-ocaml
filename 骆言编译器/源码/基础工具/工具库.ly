（* 
 * 骆言自举编译器基础工具库
 * 提供编译器所需的基础功能和数据结构
 *）

「：字符串处理工具：」
夫「字符串连接」者受 s1 s2 焉算法乃
  字符串连接 s1 s2
是谓

夫「字符串长度」者受 s 焉算法乃
  「：这里需要调用内置函数，暂时使用占位符：」
  内置_字符串长度 s
是谓

夫「字符串_从_整数」者受 n 焉算法乃
  「：整数转字符串：」
  字符串_从_整数 n
是谓

夫「整数_从_字符串」者受 s 焉算法乃
  「：字符串转整数：」
  整数_从_字符串 s
是谓

夫「字符串_以_开头」者受 字符串 前缀 焉算法乃
  「：检查字符串是否以指定前缀开头：」
  设「字符串长度」为内置_字符串长度 字符串 在
  设「前缀长度」为内置_字符串长度 前缀 在
  若 前缀长度 > 字符串长度
  则 答 假
  余者
    设「子串」为子字符串 字符串 0 前缀长度 在
    子串=前缀
是谓

夫「字符串分割」者受 分隔符 字符串 焉算法乃
  「：实现字符串按分隔符分割：」
  夫 递归 分割辅助 者 受 当前字符串 分隔符 累积 焉算法乃
    观 查找分隔符 当前字符串 分隔符 之 性
    | 无 -> 累积 @ (列开始 当前字符串 其一 列结束)
    | 有 位置 ->
      设「前部分」为子字符串 当前字符串 0 位置 在
      设「后部分」为子字符串 当前字符串 （位置 + 1） （字符串长度 当前字符串） 在
      分割辅助 后部分 分隔符 （累积 @ (列开始 前部分 其一 列结束)）
    观毕
  是谓 在
  分割辅助 字符串 分隔符 空空如也
是谓

「：列表操作工具：」
夫「列表映射」者受 f 列表 焉算法乃
  观「列表」之性
  | 空空如也 -> 空空如也
  | 头 :: 尾 -> （f 头） :: （列表映射 f 尾）
  观毕
是谓

夫「列表折叠左」者受 f 初值 列表 焉算法乃
  观「列表」之性
  | 空空如也 -> 初值
  | 头 :: 尾 -> 列表折叠左 f （f 初值 头） 尾
  观毕
是谓

夫「列表折叠右」者受 f 列表 初值 焉算法乃
  观「列表」之性
  | 空空如也 -> 初值
  | 头 :: 尾 -> f 头 （列表折叠右 f 尾 初值）
  观毕
是谓

夫「列表过滤」者受 谓词 列表 焉算法乃
  观「列表」之性
  | 空空如也 -> 空空如也
  | 头 :: 尾 when 谓词 头 -> 头 :: （列表过滤 谓词 尾）
  | _ :: 尾 -> 列表过滤 谓词 尾
  观毕
是谓

夫「列表连接」者受 列表1 列表2 焉算法乃
  观「列表1」之性
  | 空空如也 -> 列表2
  | 头 :: 尾 -> 头 :: （列表连接 尾 列表2）
  观毕
是谓

夫「列表长度」者受 列表 焉算法乃
  夫 递归 长度辅助 者 受 lst 累积 焉算法乃
    观「lst」之性
    | 空空如也 -> 累积
    | _ :: 尾 -> 长度辅助 尾 （累积 + 1）
    观毕
  是谓 在
  长度辅助 列表 0
是谓

「：选项类型操作：」
类型 选项 T=  | 无
  | 有 的 T

夫「选项映射」者受 f 选项 焉算法乃
  观「选项」之性
  | 无 -> 无
  | 有 值 -> 有 （f 值）
  观毕
是谓

夫「选项绑定」者受 选项 f 焉算法乃
  观「选项」之性
  | 无 -> 无
  | 有 值 -> f 值
  观毕
是谓

夫「选项或默认」者受 默认值 选项 焉算法乃
  观「选项」之性
  | 无 -> 默认值
  | 有 值 -> 值
  观毕
是谓

「：结果类型 - 用于错误处理：」
类型 结果 T E=  | 成功 的 T
  | 失败 的 E

夫「结果映射」者受 f 结果 焉算法乃
  观「结果」之性
  | 成功 值 -> 成功 （f 值）
  | 失败 错误 -> 失败 错误
  观毕
是谓

夫「结果映射错误」者受 f 结果 焉算法乃
  观「结果」之性
  | 成功 值 -> 成功 值
  | 失败 错误 -> 失败 （f 错误）
  观毕
是谓

夫「结果绑定」者受 结果 f 焉算法乃
  观「结果」之性
  | 成功 值 -> f 值
  | 失败 错误 -> 失败 错误
  观毕
是谓

「：文件操作：」
夫「读取文件」者受 文件路径 焉算法乃
  「：调用内置文件读取函数：」
  内置_读取文件 文件路径
是谓

夫「读取_整个文件」者受 文件路径 焉算法乃
  「：读取整个文件内容：」
  内置_读取文件 文件路径
是谓

夫「写入文件」者受 文件路径 内容 焉算法乃
  「：调用内置文件写入函数：」
  内置_写入文件 (列开始 文件路径 其一 内容 其二 列结束)
是谓

夫「文件存在」者受 文件路径 焉算法乃
  「：检查文件是否存在：」
  内置_文件存在 文件路径
是谓

「：系统操作：」
夫「系统_参数列表」者受 （） 焉算法乃
  「：获取命令行参数列表：」
  系统_参数列表 （）
是谓

夫「系统_退出」者受 退出码 焉算法乃
  「：系统退出：」
  系统_退出 退出码
是谓

「：调试和日志输出：」
夫「调试输出」者受 消息 焉算法乃
  打印 （『DEBUG: 』 ^ 消息）
是谓

夫「错误输出」者受 消息 焉算法乃
  打印 （『ERROR: 』 ^ 消息）
是谓

夫「信息输出」者受 消息 焉算法乃
  打印 （『INFO: 』 ^ 消息）
是谓

「：格式化字符串 - 简化版本：」
夫「格式化字符串」者受 模板 参数 焉算法乃
  「：简化的字符串格式化，暂时只支持基本替换：」
  模板  「：待完善实现：」
是谓

「：比较工具：」
夫「字符串比较」者受 s1 s2 焉算法乃
  if s1=s2 then 0
  else if s1 < s2 then -1
  else 1
是谓

夫「整数比较」者受 n1 n2 焉算法乃
  if n1=n2 then 0
  else if n1 < n2 then -1
  else 1
是谓

「：通用比较类型：」
类型 比较结果=  | 等于
  | 小于
  | 大于

夫「比较结果转整数」者受 比较 焉算法乃
  观「比较」之性
  | 等于 -> 0
  | 小于 -> -1
  | 大于 -> 1
  观毕
是谓