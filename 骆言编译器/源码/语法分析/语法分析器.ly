（乘
＊
＊
＊
＊

「：引入基础模块：」
使用 基础工具点工具库
使用 基础工具点位置信息
使用 基础工具点错误处理
使用 基础工具点抽象语法树
使用 词法分析点词法分析器

「：语法分析器状态：」
类型 语法分析器状态等于「
  词法单元列表： 词法单元 列表；
  可变 当前索引： 整数；
  错误收集器： 错误收集器；
  文件名： 字符串；
」

「：创建语法分析器状态：」
夫「创建语法分析器」者受 词法单元列表 文件名 焉算法乃
  设「错误收集器」为创建错误收集器 （） 在 「
    词法单元列表等于词法单元列表；
    当前索引等于0；
    错误收集器等于错误收集器；
    文件名等于文件名；
  」
也

「：获取当前词法单元：」
夫「当前词法单元」者受 状态 焉算法乃
  如果 状态点当前索引 大于等于列表点长度 状态点词法单元列表 则
    无
  余者
    有 （列表点第个 状态点词法单元列表 状态点当前索引）
也

「：预览下一个词法单元：」
夫「预览词法单元」者受 状态 偏移量 焉算法乃
  设「索引」为状态点当前索引 加 偏移量 在
  如果 索引 大于等于列表点长度 状态点词法单元列表 则
    无
  余者
    有 （列表点第个 状态点词法单元列表 索引）
也

「：前进到下一个词法单元：」
夫「前进词法单元」者受 状态 焉算法乃
  如果 状态点当前索引 小于 列表点长度 状态点词法单元列表 则
    状态点当前索引 ：等于状态点当前索引 加 1
也

「：检查当前词法单元类型：」
夫「检查词法单元类型」者受 状态 期望类型 焉算法乃
  观 当前词法单元 状态 之 性
  或 无 减大于 假
  或 有 词法单元 减大于
      观 （词法单元点类型， 期望类型） 之 性
      或 （关键字词法单元 关键字1， 关键字词法单元 关键字2） 减大于 关键字1等于关键字2
      或 （类型1， 类型2） 减大于 类型1等于类型2
      观毕
  观毕
也

「：消费特定类型的词法单元：」
夫「消费词法单元」者受 状态 期望类型 焉算法乃
  观 当前词法单元 状态 之 性
  或 无 减大于
      添加编译错误 状态点错误收集器
        （语法错误 （『期望词法单元但文件已结束』， 创建初始位置 状态点文件名））；
      无
  或 有 词法单元 减大于
      如果 检查词法单元类型 状态 期望类型 则 （
        前进词法单元 状态；
        有 词法单元
      ） 余者 （
        添加编译错误 状态点错误收集器
          （语法错误 （『期望不同的词法单元类型』， 词法单元点位置））；
        无
      ）
  观毕
也

「：跳过换行符：」
夫 递归 跳过换行符 者 受 状态 焉算法乃
  如果 检查词法单元类型 状态 换行符 则 （
    前进词法单元 状态；
    跳过换行符 状态
  ）
也

「：解析字面量：」
夫「解析字面量」者受 状态 焉算法乃
  观 当前词法单元 状态 之 性
  或 无 减大于 无
  或 有 词法单元 减大于
      观「词法单元点类型」之性
      或 整数词法单元 值 减大于
          前进词法单元 状态；
          有 （整数字面量 值）
      或 浮点词法单元 值 减大于
          前进词法单元 状态；
          有 （浮点字面量 值）
      或 字符串词法单元 值 减大于
          前进词法单元 状态；
          有 （字符串字面量 值）
      或 布尔词法单元 值 减大于
          前进词法单元 状态；
          有 （布尔字面量 值）
      或 关键字词法单元 『真』 减大于
          前进词法单元 状态；
          有 （布尔字面量 真）
      或 关键字词法单元 『假』 减大于
          前进词法单元 状态；
          有 （布尔字面量 假）
      或 下划线 减大于 无
      观毕
  观毕
也

「：解析标识符：」
夫「解析标识符」者受 状态 焉算法乃
  观 当前词法单元 状态 之 性
  或 无 减大于 无
  或 有 词法单元 减大于
      观「词法单元点类型」之性
      或 标识符词法单元 名称 减大于
          前进词法单元 状态；
          有 （名称， 词法单元点位置）
      或 下划线 减大于 无
      观毕
  观毕
也

「：声明解析函数：」
夫 递归 解析表达式 者 受 状态 焉算法乃 失败 『待实现』 也
和 解析主表达式 者 受 状态 焉算法乃 失败 『待实现』 也
和 解析一元表达式 者 受 状态 焉算法乃 失败 『待实现』 也
和 解析二元表达式 者 受 状态 优先级 焉算法乃 失败 『待实现』 也
和 解析函数调用 者 受 状态 函数表达式 焉算法乃 失败 『待实现』 也
和 解析模式 者 受 状态 焉算法乃 失败 『待实现』 也
和 解析类型表达式 者 受 状态 焉算法乃 失败 『待实现』 也
和 解析语句 者 受 状态 焉算法乃 失败 『待实现』 也

「：解析主表达式实现：」
夫「解析主表达式」者受 状态 焉算法乃
  跳过换行符 状态；

  「：首先尝试解析字面量：」
  观 解析字面量 状态 之 性
  或 有 字面量 减大于
      观 当前词法单元 状态 之 性
      或 有 词法单元 减大于 有 （字面量表达式 （字面量， 词法单元点位置））
      或 无 减大于 有 （字面量表达式 （字面量， 创建初始位置 状态点文件名））
      观毕

  或 无 减大于
      「：尝试解析标识符：」
      观 解析标识符 状态 之 性
      或 有 （名称， 位置） 减大于 有 （变量表达式 （名称， 位置））
      或 无 减大于
          「：尝试解析括号表达式：」
          如果 检查词法单元类型 状态 左括号 则 （
            观 消费词法单元 状态 左括号 之 性
            或 有 开始词法单元 减大于
                观 解析表达式 状态 之 性
                或 有 表达式 减大于
                    观 消费词法单元 状态 右括号 之 性
                    或 有 下划线 减大于 有 表达式
                    或 无 减大于
                        添加编译错误 状态点错误收集器
                          （语法错误 （『期望右括号』， 开始词法单元点位置））；
                        有 表达式
                    观毕
                或 无 减大于 无
                观毕
            或 无 减大于 无
            观毕
          ） 余者 如果 检查词法单元类型 状态 （关键字词法单元 『如果』） 则 （
            「：解析条件表达式：」
            观 消费词法单元 状态 （关键字词法单元 『如果』） 之 性
            或 有 如果词法单元 减大于
                观 解析表达式 状态 之 性
                或 有 条件表达式 减大于
                    观 消费词法单元 状态 （关键字词法单元 『那么』） 之 性
                    或 有 下划线 减大于
                        观 解析表达式 状态 之 性
                        或 有 真分支表达式 减大于
                            观 消费词法单元 状态 （关键字词法单元 『否则』） 之 性
                            或 有 下划线 减大于
                                观 解析表达式 状态 之 性
                                或 有 假分支表达式 减大于
                                    有 （条件表达式 （条件表达式， 真分支表达式， 假分支表达式， 如果词法单元点位置））
                                或 无 减大于 无
                                观毕
                            或 无 减大于
                                添加编译错误 状态点错误收集器
                                  （语法错误 （『期望『否则『』， 如果词法单元点位置））；
                                无
                            观毕
                        或 无 减大于 无
                        观毕
                    或 无 减大于
                        添加编译错误 状态点错误收集器
                          （语法错误 （『期望『那么『』， 如果词法单元点位置））；
                        无
                    观毕
                或 无 减大于 无
                观毕
            或 无 减大于 无
            观毕
          ） 余者 如果 检查词法单元类型 状态 （关键字词法单元 『让』） 则 （
            「：解析让绑定表达式：」
            观 消费词法单元 状态 （关键字词法单元 『让』） 之 性
            或 有 让词法单元 减大于
                观 解析标识符 状态 之 性
                或 有 （变量名， 下划线） 减大于
                    观 消费词法单元 状态 等号 之 性
                    或 有 下划线 减大于
                        观 解析表达式 状态 之 性
                        或 有 值表达式 减大于
                            观 消费词法单元 状态 （关键字词法单元 『在』） 之 性
                            或 有 下划线 减大于
                                观 解析表达式 状态 之 性
                                或 有 体表达式 减大于
                                    有 （让绑定表达式 （变量名， 值表达式， 体表达式， 让词法单元点位置））
                                或 无 减大于 无
                                观毕
                            或 无 减大于
                                添加编译错误 状态点错误收集器
                                  （语法错误 （『期望『在『』， 让词法单元点位置））；
                                无
                            观毕
                        或 无 减大于 无
                        观毕
                    或 无 减大于
                        添加编译错误 状态点错误收集器
                          （语法错误 （『期望等号』， 让词法单元点位置））；
                        无
                    观毕
                或 无 减大于
                    添加编译错误 状态点错误收集器
                      （语法错误 （『期望变量名』， 让词法单元点位置））；
                    无
                观毕
            或 无 减大于 无
            观毕
          ） 余者 如果 检查词法单元类型 状态 （关键字词法单元 『函数』） 则 （
            「：解析函数表达式：」
            观 消费词法单元 状态 （关键字词法单元 『函数』） 之 性
            或 有 函数词法单元 减大于
                设「参数列表」为引用 空空如也 在

                设 递归 解析参数为函数 （） 减大于
                  观 解析标识符 状态 之 性
                  或 有 （参数名， 下划线） 减大于
                      参数列表 ：等于参数名 ：： ！参数列表；
                      解析参数 （）
                  或 无 减大于 列表点反转 ！参数列表
                  观毕
                在

                设「最终参数列表」为解析参数 （） 在

                观 消费词法单元 状态 箭头 之 性
                或 有 下划线 减大于
                    观 解析表达式 状态 之 性
                    或 有 体表达式 减大于
                        有 （函数表达式 （最终参数列表， 体表达式， 函数词法单元点位置））
                    或 无 减大于 无
                    观毕
                或 无 减大于
                    添加编译错误 状态点错误收集器
                      （语法错误 （『期望箭头』， 函数词法单元点位置））；
                    无
                观毕
            或 无 减大于 无
            观毕
          ） 余者 （
            无
          ）
      观毕
  观毕
也

「：运算符优先级表：」
夫「运算符优先级」者受 运算符 焉算法乃
  观「运算符」之性
  或 逻辑或符号 减大于 1
  或 逻辑与符号 减大于 2
  或 等号 或 不等号 或 小于号 或 小于等于号 或 大于号 或 大于等于号 减大于 3
  或 加号 或 减号 或 字符串连接符号 减大于 4
  或 乘号 或 除号 或 模运算符 减大于 5
  或 下划线 减大于 0
  观毕
也

「：解析一元表达式：」
夫「解析一元表达式」者受 状态 焉算法乃
  观 当前词法单元 状态 之 性
  或 有 词法单元 减大于
      观「词法单元点类型」之性
      或 逻辑非符号 减大于
          前进词法单元 状态；
          观 解析一元表达式 状态 之 性
          或 有 子表达式 减大于 有 （一元运算表达式 （逻辑非， 子表达式， 词法单元点位置））
          或 无 减大于 无
          观毕
      或 减号 减大于
          前进词法单元 状态；
          观 解析一元表达式 状态 之 性
          或 有 子表达式 减大于 有 （一元运算表达式 （数值取反， 子表达式， 词法单元点位置））
          或 无 减大于 无
          观毕
      或 下划线 减大于 解析主表达式 状态
      观毕
  或 无 减大于 无
  观毕
也

「：二元运算符映射：」
夫「词法单元到二元运算符」者受 词法单元类型 焉算法乃
  观「词法单元类型」之性
  或 加号 减大于 有 加法
  或 减号 减大于 有 减法
  或 乘号 减大于 有 乘法
  或 除号 减大于 有 除法
  或 模运算符 减大于 有 模运算
  或 等号 减大于 有 等于
  或 不等号 减大于 有 不等于
  或 小于号 减大于 有 小于
  或 小于等于号 减大于 有 小于等于
  或 大于号 减大于 有 大于
  或 大于等于号 减大于 有 大于等于
  或 逻辑与符号 减大于 有 逻辑与
  或 逻辑或符号 减大于 有 逻辑或
  或 字符串连接符号 减大于 有 字符串连接
  或 下划线 减大于 无
  观毕
也

「：解析二元表达式：」
夫 递归 解析二元表达式 者 受 状态 最小优先级 焉算法乃
  观 解析一元表达式 状态 之 性
  或 无 减大于 无
  或 有 左表达式 减大于
      设「结果」为引用 左表达式 在

      设 递归 解析右操作数为函数 （） 减大于
        观 当前词法单元 状态 之 性
        或 无 减大于 ！结果
        或 有 运算符词法单元 减大于
            观 词法单元到二元运算符 运算符词法单元点类型 之 性
            或 无 减大于 ！结果
            或 有 运算符 减大于
                设「当前优先级」为运算符优先级 运算符词法单元点类型 在
                如果 当前优先级 小于 最小优先级 则
                  ！结果
                余者 （
                  前进词法单元 状态；
                  观 解析二元表达式 状态 （当前优先级 加 1） 之 性
                  或 无 减大于
                      添加编译错误 状态点错误收集器
                        （语法错误 （『期望右操作数』， 运算符词法单元点位置））；
                      ！结果
                  或 有 右表达式 减大于
                      结果 ：等于二元运算表达式 （！结果， 运算符， 右表达式， 运算符词法单元点位置）；
                      解析右操作数 （）
                  观毕
                ）
            观毕
        观毕
      在

      有 （解析右操作数 （））
  观毕
也

「：解析表达式：」
夫「解析表达式」者受 状态 焉算法乃
  解析二元表达式 状态 0
也

「：解析程序：」
夫「解析程序」者受 状态 焉算法乃
  设「语句列表」为引用 空空如也 在

  设 递归 解析语句序列为函数 （） 减大于
    跳过换行符 状态；

    观 当前词法单元 状态 之 性
    或 无 减大于 列表点反转 ！语句列表
    或 有 词法单元 减大于
        观「词法单元点类型」之性
        或 文件结束 减大于 列表点反转 ！语句列表
        或 下划线 减大于
            观 解析表达式 状态 之 性
            或 有 表达式 减大于
                语句列表 ：等于（表达式语句 表达式） ：： ！语句列表；
                「：可选的分号：」
                如果 检查词法单元类型 状态 分号 则
                  前进词法单元 状态；
                解析语句序列 （）
            或 无 减大于
                添加编译错误 状态点错误收集器
                  （语法错误 （『无法解析语句』， 词法单元点位置））；
                前进词法单元 状态；  「：跳过错误的词法单元：」
                解析语句序列 （）
            观毕
        观毕
    观毕
  在

  解析语句序列 （）
也

「：语法分析入口函数：」
夫「语法分析」者受 词法单元列表 文件名 焉算法乃
  设「状态」为创建语法分析器 词法单元列表 文件名 在

  设「程序」为解析程序 状态 在

  如果 有错误 状态点错误收集器 则
    创建失败结果 状态点错误收集器
  余者
    创建成功结果 程序 状态点错误收集器
也
