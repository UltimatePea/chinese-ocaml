#!/usr/bin/env python3
"""
åˆ›å»ºæŠ€æœ¯å€ºåŠ¡æ”¹è¿›issue - åŸºäºé•¿å‡½æ•°åˆ†ææŠ¥å‘Š
"""

import json
import sys
from github_auth import get_installation_token
import requests

def create_tech_debt_issue():
    """åˆ›å»ºæŠ€æœ¯å€ºåŠ¡æ”¹è¿›çš„issue"""
    
    issue_title = "æŠ€æœ¯å€ºåŠ¡æ”¹è¿›ï¼šé•¿å‡½æ•°é‡æ„å’Œæ•°æ®å¤–åŒ–ä¼˜åŒ–"
    
    issue_body = """## é—®é¢˜æè¿°

åŸºäºæœ€æ–°çš„é•¿å‡½æ•°åˆ†ææŠ¥å‘Šï¼Œéª†è¨€é¡¹ç›®æ•´ä½“ä»£ç è´¨é‡è‰¯å¥½ï¼Œä½†ä»æœ‰ä¸€äº›æ”¹è¿›æœºä¼šï¼Œç‰¹åˆ«æ˜¯åœ¨å‡½æ•°é•¿åº¦å’Œæ•°æ®ç»„ç»‡æ–¹é¢ã€‚

## åˆ†æç»“æœæ‘˜è¦

### âœ… ä¼˜ç§€è¡¨ç°
- **é›¶å‡½æ•°è¶…è¿‡150è¡Œ** - è¡¨æ˜é¡¹ç›®å‡½æ•°é•¿åº¦æ§åˆ¶ä¼˜ç§€
- æ•´ä½“ä»£ç è´¨é‡è‰¯å¥½ï¼Œç¬¦åˆç°ä»£OCamlå¼€å‘æœ€ä½³å®è·µ

### âš ï¸ éœ€è¦æ”¹è¿›çš„åœ°æ–¹
- **5ä¸ªå‡½æ•°åœ¨100-150è¡ŒèŒƒå›´** - éœ€è¦é«˜ä¼˜å…ˆçº§é‡æ„
- **11ä¸ªå¤§å‹æ•°æ®ç»“æ„å‡½æ•°** - éœ€è¦æ•°æ®å¤–åŒ–è€ƒè™‘

## å…·ä½“æ”¹è¿›é¡¹ç›®

### ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šæ•°æ®å¤–åŒ–ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰

#### ğŸ¯ ç›®æ ‡å‡½æ•°
1. **`ping_sheng_chars`** (135è¡Œ) - `src/poetry/data/tone_data/ping_sheng_data.ml`
2. **`shang_sheng_chars`** (101è¡Œ) - `src/poetry/data/tone_data/shang_sheng_data.ml`
3. **`char_definitions`** (133è¡Œ) - `src/unicode/unicode_types.ml`

#### ğŸ”§ å®æ–½æ–¹æ¡ˆ
- å°†å­—ç¬¦åˆ—è¡¨è¿ç§»åˆ° `data/poetry/` ç›®å½•ä¸‹çš„JSONæ–‡ä»¶
- åˆ›å»ºç»Ÿä¸€çš„æ•°æ®åŠ è½½å™¨æ¥å£
- å®ç°ç¼“å­˜æœºåˆ¶æé«˜æ€§èƒ½
- ä¿æŒå‘åå…¼å®¹æ€§

### ç¬¬äºŒä¼˜å…ˆçº§ï¼šæµ‹è¯•å‡½æ•°åˆ†è§£

#### ğŸ¯ ç›®æ ‡å‡½æ•°
- **`test_chinese_best_practices`** (144è¡Œ) - `src/chinese_best_practices_backup.ml`

#### ğŸ”§ å®æ–½æ–¹æ¡ˆ
- åˆ†è§£ä¸ºç‹¬ç«‹çš„æµ‹è¯•å‡½æ•°
- æ¯ä¸ªæµ‹è¯•å‡½æ•°ä¸“æ³¨å•ä¸€åŠŸèƒ½
- æ”¹å–„é”™è¯¯è¯Šæ–­èƒ½åŠ›

### ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šJSONè§£æå™¨ä¼˜åŒ–

#### ğŸ¯ ç›®æ ‡å‡½æ•°
- `poetry_data_loader.ml` ä¸­çš„è§£æé€»è¾‘ (113è¡Œ)

#### ğŸ”§ å®æ–½æ–¹æ¡ˆ
- æå–JSONè§£æä¸ºç‹¬ç«‹å‡½æ•°
- åˆ†ç¦»é”™è¯¯å¤„ç†é€»è¾‘
- æ”¹å–„å¼‚å¸¸å¤„ç†

## å®æ–½è·¯çº¿å›¾

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®å¤–åŒ–ï¼ˆ1-2å‘¨ï¼‰
1. åˆ†æç°æœ‰æ•°æ®ç»“æ„
2. è®¾è®¡JSON schema
3. å®ç°æ•°æ®è¿ç§»å·¥å…·
4. åˆ›å»ºåŠ è½½å™¨æ¥å£
5. æ€§èƒ½æµ‹è¯•éªŒè¯

### ç¬¬äºŒé˜¶æ®µï¼šå‡½æ•°åˆ†è§£ï¼ˆ1å‘¨ï¼‰
1. é‡æ„æµ‹è¯•å‡½æ•°
2. åˆ†è§£Unicodeå®šä¹‰
3. ä¼˜åŒ–JSONè§£æå™¨
4. ä»£ç å®¡æŸ¥

### ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰
1. å®ç°ç¼“å­˜æœºåˆ¶
2. ç®—æ³•å¤æ‚åº¦ä¼˜åŒ–
3. å†…å­˜ä½¿ç”¨ä¼˜åŒ–
4. æ€§èƒ½åŸºå‡†æµ‹è¯•

## æˆåŠŸæŒ‡æ ‡

### ğŸ“Š é‡åŒ–æŒ‡æ ‡
- å‡½æ•°å¹³å‡é•¿åº¦å‡å°‘20%
- æ•°æ®åŠ è½½æ€§èƒ½æå‡15%
- ä»£ç å¤æ‚åº¦é™ä½30%
- æµ‹è¯•è¦†ç›–ç‡ç»´æŒ95%ä»¥ä¸Š

### ğŸ¯ è´¨é‡æŒ‡æ ‡
- ä»£ç å¯è¯»æ€§æ˜¾è‘—æå‡
- æ¨¡å—è¾¹ç•Œæ›´åŠ æ¸…æ™°
- é”™è¯¯å¤„ç†æ›´åŠ è§„èŒƒ
- æ–‡æ¡£å®Œæ•´æ€§æ”¹å–„

## é£é™©è¯„ä¼°å’Œç¼“è§£

### ğŸ”´ é«˜é£é™©é¡¹
- **æ•°æ®å¤–åŒ–**: å¯èƒ½å½±å“ç°æœ‰ä¾èµ–
  - **ç¼“è§£**: ä¿æŒå‘åå…¼å®¹ï¼Œæ¸è¿›å¼è¿ç§»
- **å¤§å‹é‡æ„**: å¯èƒ½å¼•å…¥æ–°bug
  - **ç¼“è§£**: å……åˆ†çš„æµ‹è¯•è¦†ç›–ï¼Œåˆ†é˜¶æ®µå®æ–½

## ç›¸å…³æ–‡æ¡£

- [é•¿å‡½æ•°åˆ†ææŠ¥å‘Š](doc/analysis/)
- [æŠ€æœ¯å€ºåŠ¡ç»¼åˆè¯„ä¼°æŠ¥å‘Š](doc/analysis/éª†è¨€é¡¹ç›®æŠ€æœ¯å€ºåŠ¡ç»¼åˆè¯„ä¼°æŠ¥å‘Š_2025-07-20.md)
- [é¡¹ç›®ç»“æ„æ–‡æ¡£](STRUCTURE.md)

## æ ‡ç­¾

- `tech-debt` - æŠ€æœ¯å€ºåŠ¡
- `refactoring` - é‡æ„
- `performance` - æ€§èƒ½ä¼˜åŒ–
- `maintainability` - å¯ç»´æŠ¤æ€§

---

**åˆ›å»ºæ—¶é—´**: 2025-07-21  
**ä¼˜å…ˆçº§**: ä¸­ç­‰  
**é¢„ä¼°å·¥ä½œé‡**: 4-5å‘¨  
**å½±å“èŒƒå›´**: æ•°æ®åŠ è½½ã€å‡½æ•°ç»„ç»‡ã€ä»£ç å¯ç»´æŠ¤æ€§
"""

    try:
        token = get_installation_token()
        
        headers = {
            'Authorization': f'token {token}',
            'Accept': 'application/vnd.github+json'
        }
        
        url = 'https://api.github.com/repos/UltimatePea/chinese-ocaml/issues'
        
        issue_data = {
            'title': issue_title,
            'body': issue_body,
            'labels': ['tech-debt', 'refactoring', 'performance', 'maintainability']
        }
        
        response = requests.post(url, headers=headers, json=issue_data)
        response.raise_for_status()
        
        issue = response.json()
        print(f"âœ… Issue åˆ›å»ºæˆåŠŸ!")
        print(f"Issue ç¼–å·: #{issue['number']}")
        print(f"Issue æ ‡é¢˜: {issue['title']}")
        print(f"Issue URL: {issue['html_url']}")
        
        return issue['number']
        
    except Exception as e:
        print(f"âŒ åˆ›å»ºIssueå¤±è´¥: {e}")
        return None

if __name__ == '__main__':
    issue_number = create_tech_debt_issue()
    if issue_number:
        print(f"\nğŸ‰ æŠ€æœ¯å€ºåŠ¡æ”¹è¿›Issue #{issue_number} åˆ›å»ºå®Œæˆï¼")
    else:
        print("\nğŸ’¥ Issueåˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè®¤è¯é…ç½®")
        sys.exit(1)