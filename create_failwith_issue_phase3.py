#!/usr/bin/env python3

import github_auth
import requests

def create_issue():
    try:
        # è·å–installation token
        token = github_auth.get_installation_token()
        
        headers = {
            'Authorization': f'token {token}',
            'Accept': 'application/vnd.github+json'
        }
        
        # åˆ›å»ºissue
        issue_data = {
            'title': 'æŠ€æœ¯å€ºåŠ¡æ”¹è¿›ï¼šç¬¬ä¸‰é˜¶æ®µ failwith é”™è¯¯å¤„ç†ç»Ÿä¸€åŒ–è¿ç§» - æœ€ç»ˆå®Œå–„',
            'body': '''## æ¦‚è¿°

åŸºäºæœ€æ–°çš„æŠ€æœ¯å€ºåŠ¡åˆ†ææŠ¥å‘Šï¼Œæ¨è¿› failwith é”™è¯¯å¤„ç†åˆ°ç»Ÿä¸€é”™è¯¯å¤„ç†ç³»ç»Ÿçš„æœ€ç»ˆè¿ç§»é˜¶æ®µã€‚è¿™æ˜¯ç»§ç¬¬ä¸€é˜¶æ®µï¼ˆIssue #736ï¼‰å’Œç¬¬äºŒé˜¶æ®µï¼ˆIssue #738ï¼‰ä¹‹åçš„ç¬¬ä¸‰é˜¶æ®µæ”¹è¿›ï¼Œæ—¨åœ¨å®Œæˆæ•´ä¸ªé”™è¯¯å¤„ç†ç³»ç»Ÿçš„ç»Ÿä¸€åŒ–ã€‚

## èƒŒæ™¯

å‰ä¸¤é˜¶æ®µå·²æˆåŠŸå®Œæˆï¼š
- **ç¬¬ä¸€é˜¶æ®µ**ï¼šæ ¸å¿ƒæ¨¡å—é”™è¯¯æ¶ˆæ¯æ ¼å¼ç»Ÿä¸€åŒ–
- **ç¬¬äºŒé˜¶æ®µ**ï¼šè¯æ³•è§£æå’Œè¯—è¯åˆ†ææ¨¡å—è¿ç§»

æœ€æ–°æŠ€æœ¯å€ºåŠ¡åˆ†æå‘ç°ï¼š
- ä»æœ‰ **25å¤„ failwith è°ƒç”¨** åˆ†å¸ƒåœ¨ **13ä¸ªæ–‡ä»¶** ä¸­
- ä¸»è¦é›†ä¸­åœ¨è¯—è¯å¤„ç†å’Œè¡¨è¾¾å¼è§£ææ¨¡å—
- éœ€è¦å®Œæˆæœ€ç»ˆçš„é”™è¯¯å¤„ç†ç»Ÿä¸€åŒ–

## ç¬¬ä¸‰é˜¶æ®µè¿ç§»èŒƒå›´

### é‡ç‚¹æ–‡ä»¶ï¼ˆåŸºäºåˆ†ææŠ¥å‘Šï¼‰ï¼š

1. **è¯—è¯æ¨¡å—**ï¼š
   - `poetry/rhyme_json_data_loader.ml` - éŸµå¾‹æ•°æ®åŠ è½½é”™è¯¯
   - `poetry/parallelism_analysis.ml` - å¯¹å¶åˆ†æé”™è¯¯
   - `poetry/poetry_classifier.ml` - è¯—è¯åˆ†ç±»é”™è¯¯

2. **è§£æå™¨æ¨¡å—**ï¼š
   - `parser_expressions_utils.ml` - è¡¨è¾¾å¼è§£æå·¥å…·é”™è¯¯
   - `parser_types.ml` - ç±»å‹è§£æé”™è¯¯

3. **å…¶ä»–æ ¸å¿ƒæ¨¡å—**ï¼š
   - æ•°æ®å¤„ç†å’Œæ–‡ä»¶æ“ä½œç›¸å…³é”™è¯¯
   - ç¼–è¯‘å™¨å†…éƒ¨çŠ¶æ€é”™è¯¯

### æŠ€æœ¯ç›®æ ‡

1. **é”™è¯¯ç±»å‹æ‰©å±•**ï¼š
   - æ‰©å±• `unified_errors.ml` æ”¯æŒè¯—è¯åˆ†æç‰¹å®šé”™è¯¯
   - æ–°å¢éŸµå¾‹æ•°æ®ã€å¯¹å¶åˆ†æã€è¯—è¯åˆ†ç±»é”™è¯¯å­ç±»å‹
   - å®Œå–„è¡¨è¾¾å¼è§£æé”™è¯¯å¤„ç†

2. **è¿ç§»ç­–ç•¥**ï¼š
   - ä¿æŒå‘åå…¼å®¹æ€§
   - ä¸­æ–‡åŒ–é”™è¯¯æ¶ˆæ¯
   - é¿å…æ¨¡å—å¾ªç¯ä¾èµ–
   - æ¸è¿›å¼è¿ç§»ï¼Œç¡®ä¿æ„å»ºç¨³å®š

3. **è´¨é‡ä¿è¯**ï¼š
   - æ¯ä¸ªè¿ç§»æ­¥éª¤ç‹¬ç«‹éªŒè¯
   - å®Œæ•´çš„æ„å»ºæµ‹è¯•
   - é”™è¯¯æ¶ˆæ¯æ ¼å¼ä¸€è‡´æ€§æ£€æŸ¥

## é¢„æœŸæ”¶ç›Š

- **ä»£ç è´¨é‡**ï¼šæ¶ˆé™¤æ‰€æœ‰ failwith è°ƒç”¨ï¼Œå®ç°100%ç»Ÿä¸€é”™è¯¯å¤„ç†
- **å¯ç»´æŠ¤æ€§**ï¼šé”™è¯¯å¤„ç†é€»è¾‘é›†ä¸­åŒ–ï¼Œä¾¿äºç»´æŠ¤å’Œè°ƒè¯•
- **ç”¨æˆ·ä½“éªŒ**ï¼šç»Ÿä¸€çš„ä¸­æ–‡é”™è¯¯æ¶ˆæ¯æ ¼å¼
- **æŠ€æœ¯å€ºåŠ¡**ï¼šå®Œæˆé”™è¯¯å¤„ç†ç³»ç»Ÿç°ä»£åŒ–æ”¹é€ 

## å®æ–½è®¡åˆ’

1. **å‡†å¤‡é˜¶æ®µ**ï¼šæ‰©å±• `unified_errors.ml` é”™è¯¯ç±»å‹ç³»ç»Ÿ
2. **è¿ç§»é˜¶æ®µ**ï¼šé€æ–‡ä»¶è¿ç§»å‰©ä½™ failwith è°ƒç”¨
3. **éªŒè¯é˜¶æ®µ**ï¼šå…¨é¢æ„å»ºå’Œé”™è¯¯å¤„ç†æµ‹è¯•
4. **å®Œå–„é˜¶æ®µ**ï¼šæ–‡æ¡£æ›´æ–°å’Œæœ€ç»ˆä¼˜åŒ–

## æˆåŠŸæ ‡å‡†

- âœ… ä»£ç åº“ä¸­æ— å‰©ä½™ failwith è°ƒç”¨
- âœ… æ‰€æœ‰é”™è¯¯æ¶ˆæ¯ä½¿ç”¨ç»Ÿä¸€æ ¼å¼
- âœ… æ„å»ºç³»ç»Ÿé€šè¿‡æ‰€æœ‰æ£€æŸ¥
- âœ… é”™è¯¯å¤„ç†æ–‡æ¡£å®Œæ•´æ›´æ–°

---

**ç±»å‹**: æŠ€æœ¯å€ºåŠ¡æ”¹è¿›  
**ä¼˜å…ˆçº§**: é«˜  
**å½±å“èŒƒå›´**: è¯—è¯åˆ†æå’Œè§£æå™¨æ¨¡å—  
**å‰ç½®ä¾èµ–**: Issue #738 (å·²å®Œæˆ)

**åˆ†é…ç»™**: @claudeai-v1[bot]

ğŸ¤– åŸºäºæŠ€æœ¯å€ºåŠ¡æ·±åº¦åˆ†ææŠ¥å‘Šåˆ›å»º''',
            'assignees': ['claudeai-v1[bot]'],
            'labels': ['technical-debt', 'error-handling', 'phase-3']
        }
        
        url = 'https://api.github.com/repos/UltimatePea/chinese-ocaml/issues'
        response = requests.post(url, headers=headers, json=issue_data)
        
        if response.status_code == 201:
            issue_info = response.json()
            print(f'âœ… Issue #{issue_info["number"]} åˆ›å»ºæˆåŠŸ!')
            print(f'Issue URL: {issue_info["html_url"]}')
            return issue_info["number"]
        else:
            print(f'âŒ Issue åˆ›å»ºå¤±è´¥:')
            print(f'çŠ¶æ€ç : {response.status_code}')
            print(f'å“åº”: {response.text}')
            return None
            
    except Exception as e:
        print(f'é”™è¯¯: {e}')
        return None

if __name__ == '__main__':
    issue_number = create_issue()
    if issue_number:
        print(f'\nä¸‹ä¸€æ­¥ï¼šåˆ›å»ºPRæ¥è§£å†³ Issue #{issue_number}')