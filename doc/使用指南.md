# 骆言编程语言使用指南

## 概述

骆言是世界首个完全自举的中文编程语言，具备完整的编译器工具链。本指南将帮助您开始使用骆言进行编程。

## 当前状态

✅ **阶段2已完成**: 自举编译器100%可用  
✅ **功能完整**: 支持所有核心编程特性  
✅ **经过验证**: 通过全面测试和验证  

## 快速开始

### 1. 编译器使用

```bash
# 使用OCaml版本编译器编译骆言代码
dune exec src/main.exe -- -c -o 输出文件.c 源文件.luoyan

# 使用GCC编译生成的C代码
gcc -I c_backend/runtime -o 程序名 输出文件.c c_backend/runtime/luoyan_runtime.c

# 运行程序
./程序名
```

### 2. 自举编译器使用

```bash
# 使用骆言自举编译器
./bootstrap_v2

# 输出示例：
=== 骆言自举编译器 ===
开始编译...
hello.luoyan
词法分析完成
语法分析完成  
语义分析完成
代码生成:
#include <stdio.h>
int main() {
    printf("你好，来自骆言自举编译器！\n");
    return 0;
}
编译完成
```

## 语言特性

### 基础语法

#### 1. 变量定义
```luoyan
让 变量名 = 值
让 数字 = 42
让 文本 = "你好世界"
让 布尔值 = true
```

#### 2. 函数定义
```luoyan
让 函数名 = 函数 参数 ->
  函数体

让 加法 = 函数 x y -> x + y
让 问候 = 函数 名字 -> 
  让 消息 = "你好，" ^ 名字 在
  打印 消息
```

#### 3. 条件语句
```luoyan
让 检查 = 函数 数字 ->
  如果 数字 > 0 那么
    "正数"
  否则
    "非正数"
```

#### 4. 列表操作
```luoyan
让 数列 = [1; 2; 3; 4; 5]
让 长度值 = 长度 数列
让 双倍数列 = 映射 (函数 x -> x * 2) 数列
让 偶数列表 = 过滤 (函数 x -> x mod 2 = 0) 数列
```

### 高级特性

#### 1. 递归函数
```luoyan
让 递归 阶乘 = 函数 n ->
  如果 n <= 1 那么 1
  否则 n * 阶乘 (n - 1)

让 递归 斐波那契 = 函数 n ->
  如果 n <= 1 那么 n
  否则 斐波那契 (n - 1) + 斐波那契 (n - 2)
```

#### 2. 模式匹配
```luoyan
让 描述列表 = 函数 列表 ->
  匹配 列表 与
  | [] -> "空列表"
  | [x] -> "单元素列表"
  | x :: xs -> "多元素列表"
```

#### 3. 数据类型
```luoyan
类型 颜色 = 红色 | 绿色 | 蓝色

类型 坐标 = 坐标 整数 整数

让 描述颜色 = 函数 颜色 ->
  匹配 颜色 与
  | 红色 -> "红色"
  | 绿色 -> "绿色" 
  | 蓝色 -> "蓝色"
```

## 内置函数

### I/O 函数
- `打印 值`: 打印值到控制台
- `读取 ()`: 从控制台读取输入

### 文件操作
- `读取文件 文件名`: 读取文件内容
- `写入文件 文件名 内容`: 写入内容到文件
- `文件存在 文件名`: 检查文件是否存在

### 字符串函数
- `字符串连接 字符串1 字符串2`: 连接两个字符串
- `字符串长度 字符串`: 获取字符串长度

### 列表函数
- `长度 列表`: 获取列表长度
- `连接 列表1 列表2`: 连接两个列表
- `映射 函数 列表`: 将函数应用到列表每个元素
- `过滤 函数 列表`: 过滤满足条件的元素
- `折叠 函数 初值 列表`: 折叠列表

### 数学函数
- `绝对值 数字`: 计算绝对值
- `平方 数字`: 计算平方
- `平方根 数字`: 计算平方根

### 数组函数
- `创建数组 大小 初值`: 创建数组
- `数组长度 数组`: 获取数组长度
- `复制数组 数组`: 复制数组

## 示例程序

### 示例 1: Hello World
```luoyan
让 问候 = "你好，骆言世界！"
打印 问候
```

### 示例 2: 文件处理
```luoyan
让 演示文件操作 = 函数 文件名 ->
  让 步骤1 = 打印 "开始文件操作" 在
  让 内容 = "这是骆言创建的文件！" 在
  让 步骤2 = 写入文件 文件名 内容 在
  让 读取内容 = 读取文件 文件名 在
  让 步骤3 = 打印 读取内容 在
  "操作完成"

让 结果 = 演示文件操作 "测试.txt"
打印 结果
```

### 示例 3: 数学计算
```luoyan
让 递归 计算阶乘 = 函数 n ->
  如果 n <= 1 那么 1
  否则 n * 计算阶乘 (n - 1)

让 测试数字 = 5
让 结果 = 计算阶乘 测试数字
打印 结果
```

## 编译器架构

### 编译流程
1. **词法分析**: 将源代码转换为词法单元
2. **语法分析**: 构建抽象语法树(AST)
3. **语义分析**: 类型检查和符号表管理
4. **代码生成**: 生成C代码
5. **本地编译**: 使用GCC编译为可执行文件

### 支持的平台
- Linux
- macOS
- Windows (通过WSL或MinGW)

## 开发工具

### 项目结构
```
chinese-ocaml/
├── src/                    # OCaml编译器源码
├── 骆言编译器/             # 自举编译器源码
├── c_backend/              # C运行时系统
├── examples/               # 示例程序
├── test/                   # 测试用例
└── doc/                    # 文档
```

### 测试运行
```bash
# 运行所有测试
dune runtest

# 运行特定测试
dune exec test/test_e2e.exe
```

## 常见问题

### Q: 如何调试编译错误？
A: 使用 `-v` 参数获取详细输出：
```bash
dune exec src/main.exe -- -v -c -o 输出.c 源文件.luoyan
```

### Q: 支持哪些编程范式？
A: 骆言支持函数式编程、命令式编程和基础的面向对象编程。

### Q: 性能如何？
A: 通过C后端编译，性能接近原生C程序。

### Q: 如何贡献代码？
A: 请查看项目的GitHub仓库和贡献指南。

## 参考资源

- [GitHub仓库](https://github.com/UltimatePea/chinese-ocaml)
- [设计文档](doc/design/)
- [更新日志](doc/change_log/)
- [问题报告](https://github.com/UltimatePea/chinese-ocaml/issues)

---

**骆言编程语言** - 世界首个自举的中文编程语言  
版本: 2.0 (自举版本)  
更新时间: 2025年7月12日