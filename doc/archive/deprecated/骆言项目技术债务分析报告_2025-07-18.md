# éª†è¨€é¡¹ç›®æŠ€æœ¯å€ºåŠ¡åˆ†ææŠ¥å‘Š

**ç”Ÿæˆæ—¥æœŸ**: 2025-07-18  
**åˆ†æèŒƒå›´**: src/ ç›®å½•åŠå…¶å­ç›®å½•  
**åˆ†æå·¥å…·**: Claude Code é™æ€åˆ†æ

## åˆ†ææ‘˜è¦

ç»è¿‡å…¨é¢çš„æŠ€æœ¯å€ºåŠ¡åˆ†æï¼Œå‘ç°éª†è¨€é¡¹ç›®åœ¨ä»£ç è´¨é‡æ–¹é¢å·²ç»æœ‰äº†æ˜¾è‘—æ”¹å–„ï¼Œä½†ä»å­˜åœ¨ä¸€äº›éœ€è¦å…³æ³¨çš„æŠ€æœ¯å€ºåŠ¡é—®é¢˜ã€‚

## ä¸»è¦å‘ç°

### 1. ç¼–è¯‘çŠ¶æ€
âœ… **è‰¯å¥½** - é¡¹ç›®å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œæ²¡æœ‰ç¼–è¯‘è­¦å‘Šæˆ–é”™è¯¯
âœ… **è‰¯å¥½** - æµ‹è¯•å¯ä»¥æ­£å¸¸è¿è¡Œ

### 2. é•¿å‡½æ•°åˆ†æ (>100è¡Œ)

å‘ç°17ä¸ªè¶…è¿‡100è¡Œçš„å‡½æ•°ï¼š

#### ğŸ”´ æé•¿å‡½æ•° (>300è¡Œ)
- `parser_expressions.ml`: `parse_expression` (502è¡Œ) - ä¸»è¡¨è¾¾å¼è§£æå™¨
- `parser_expressions_primary.ml`: `parse_function_call_or_variable` (281è¡Œ) - å‡½æ•°è°ƒç”¨è§£æ

#### ğŸŸ¡ é•¿å‡½æ•° (100-300è¡Œ)
- `parser.ml`: `_parse_natural_function_definition` (220è¡Œ)
- `expression_evaluator.ml`: `eval_expr` (188è¡Œ)
- `semantic_expressions.ml`: `analyze_expression` (171è¡Œ)
- `semantic_expressions.ml`: `env` (170è¡Œ)
- `semantic_expressions.ml`: `context1` (164è¡Œ)
- `parser_expressions_natural_language.ml`: `parse_natural_function_definition` (159è¡Œ)
- `poetry/artistic_evaluation.ml`: `enhanced_comprehensive_artistic_evaluation` (155è¡Œ)
- `parser_expressions_main.ml`: `parse_expression` (154è¡Œ)
- `parser_expressions_assignment.ml`: `parse_assignment_expression` (141è¡Œ)
- `poetry/tone_data.ml`: `ping_sheng_chars` (127è¡Œ)
- `types_infer.ml`: `infer_type` (126è¡Œ)
- `types_unify.ml`: `unify` (118è¡Œ)
- `expression_evaluator_data.ml`: `eval_data_structure_expr` (117è¡Œ)
- `parser_types.ml`: `parse_variant_labels` (106è¡Œ)
- `parser_expressions_function.ml`: `parse_function_expression` (105è¡Œ)

### 3. ç¼ºå¤±çš„æ¥å£æ–‡ä»¶ (.mli)

å‘ç°14ä¸ªç¼ºå¤±çš„æ¥å£æ–‡ä»¶ï¼š

#### ğŸ”´ ä¸»è¦æ¨¡å—
- `lexer_keywords.ml` - ç¼ºå°‘ `.mli`
- `lexer_token_converter.ml` - ç¼ºå°‘ `.mli`
- `lexer_token_conversion_*.ml` (5ä¸ªæ–‡ä»¶) - ç¼ºå°‘ `.mli`

#### ğŸŸ¡ å­æ¨¡å—
- `lexer/token_mapping/` ç›®å½•ä¸‹çš„5ä¸ªæ–‡ä»¶ç¼ºå°‘ `.mli`
- `poetry/data/` ç›®å½•ä¸‹çš„2ä¸ªæ•°æ®æ–‡ä»¶ç¼ºå°‘ `.mli`

### 4. è°ƒè¯•ä»£ç æ®‹ç•™

å‘ç°å°‘é‡è°ƒè¯•ä»£ç æ®‹ç•™ï¼š

#### ğŸŸ¡ æ€§èƒ½ç»Ÿè®¡ä»£ç 
- `types_cache.ml` - åŒ…å« `Printf.printf` æ€§èƒ½ç»Ÿè®¡è¾“å‡º
- `parser_poetry.ml` - åŒ…å«è°ƒè¯•æ—¥å¿—å™¨åˆå§‹åŒ–å’Œè°ƒç”¨

### 5. ä»£ç é‡å¤

âœ… **è‰¯å¥½** - é€šè¿‡æ¨¡å—åŒ–é‡æ„ï¼Œä»£ç é‡å¤é—®é¢˜å·²åŸºæœ¬è§£å†³

### 6. æ³¨é‡Šä»£ç 

âœ… **è‰¯å¥½** - æ²¡æœ‰å‘ç°å¤§é‡æ³¨é‡Šæ‰çš„ä»£ç ï¼Œç°æœ‰æ³¨é‡Šä¸»è¦æ˜¯æ–‡æ¡£æ³¨é‡Š

### 7. TODO/FIXME æ ‡è®°

âœ… **è‰¯å¥½** - æ²¡æœ‰å‘ç°æœªå®Œæˆçš„ TODO æˆ– FIXME æ ‡è®°

### 8. å­¤ç«‹æ–‡ä»¶

âœ… **å·²æ¸…ç†** - å·²ç§»é™¤ `src/find_long_functions.py` å­¤ç«‹æ–‡ä»¶

## æŠ€æœ¯å€ºåŠ¡ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³å¤„ç†ï¼‰

1. **è¶…é•¿å‡½æ•°é‡æ„**
   - `parser_expressions.ml:parse_expression` (502è¡Œ)
   - `parser_expressions_primary.ml:parse_function_call_or_variable` (281è¡Œ)
   
2. **å…³é”®æ¨¡å—æ¥å£æ–‡ä»¶**
   - `lexer_keywords.mli`
   - `lexer_token_converter.mli`

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆçŸ­æœŸå†…å¤„ç†ï¼‰

1. **é•¿å‡½æ•°åˆ†è§£**
   - å…¶ä½™15ä¸ªè¶…è¿‡100è¡Œçš„å‡½æ•°
   
2. **å‰©ä½™æ¥å£æ–‡ä»¶**
   - 12ä¸ªç¼ºå¤±çš„ `.mli` æ–‡ä»¶

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸç»´æŠ¤ï¼‰

1. **è°ƒè¯•ä»£ç æ¸…ç†**
   - ç§»é™¤æ€§èƒ½ç»Ÿè®¡çš„ `Printf.printf` è¯­å¥
   - è§„èŒƒåŒ–æ—¥å¿—å™¨ä½¿ç”¨

## æ”¹è¿›å»ºè®®

### 1. å‡½æ•°é‡æ„ç­–ç•¥
- å°†å¤§å‹å‡½æ•°åˆ†è§£ä¸ºé€»è¾‘ç›¸å…³çš„å°å‡½æ•°
- ä½¿ç”¨æ¨¡å—åŒ–æ–¹æ³•ç»„ç»‡ç›¸å…³åŠŸèƒ½
- ä¿æŒå‡½æ•°å•ä¸€èŒè´£åŸåˆ™

### 2. æ¥å£æ–‡ä»¶åˆ›å»º
- ä¸ºæ‰€æœ‰å…¬å…±æ¨¡å—åˆ›å»º `.mli` æ–‡ä»¶
- æ˜ç¡®æ¨¡å—çš„å…¬å…±æ¥å£
- éšè—å†…éƒ¨å®ç°ç»†èŠ‚

### 3. è°ƒè¯•ä»£ç æ¸…ç†
- ç§»é™¤ç”Ÿäº§ä»£ç ä¸­çš„è°ƒè¯•è¾“å‡º
- ä½¿ç”¨ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ
- ä¿æŒä»£ç æ•´æ´

## ç»“è®º

éª†è¨€é¡¹ç›®çš„æŠ€æœ¯å€ºåŠ¡çŠ¶å†µç›¸å¯¹è‰¯å¥½ï¼Œä¸»è¦é—®é¢˜é›†ä¸­åœ¨ï¼š
1. å°‘æ•°è¶…é•¿å‡½æ•°éœ€è¦é‡æ„
2. éƒ¨åˆ†æ¨¡å—ç¼ºå°‘æ¥å£æ–‡ä»¶
3. å°‘é‡è°ƒè¯•ä»£ç æ®‹ç•™

å»ºè®®ä¼˜å…ˆå¤„ç†è¶…é•¿å‡½æ•°é‡æ„ï¼Œè¿™å°†æ˜¾è‘—æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. åˆ›å»º Issue è¿½è¸ªè¶…é•¿å‡½æ•°é‡æ„
2. ä¸ºå…³é”®æ¨¡å—åˆ›å»ºæ¥å£æ–‡ä»¶
3. æ¸…ç†è°ƒè¯•ä»£ç 
4. å»ºç«‹ä»£ç è´¨é‡æ£€æŸ¥æœºåˆ¶

---

*æ­¤æŠ¥å‘Šç”± Claude Code è‡ªåŠ¨ç”Ÿæˆï¼ŒåŸºäºé™æ€ä»£ç åˆ†æç»“æœã€‚*