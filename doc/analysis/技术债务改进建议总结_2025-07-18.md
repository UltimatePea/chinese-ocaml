# éª†è¨€é¡¹ç›®æŠ€æœ¯å€ºåŠ¡æ”¹è¿›å»ºè®®æ€»ç»“

**åŸºäº**: éª†è¨€é¡¹ç›®æŠ€æœ¯å€ºåŠ¡æ·±åº¦åˆ†ææŠ¥å‘Š_2025-07-18  
**ç›®æ ‡**: ä¸ºIssue #108è¯­è¨€è‰ºæœ¯æ€§æå‡æä¾›æŠ€æœ¯åŸºç¡€  

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›å»ºè®®

### 1. è¶…é•¿å‡½æ•°é‡æ„ (æœ€é«˜ä¼˜å…ˆçº§)

#### ç«‹å³å¤„ç†çš„å…³é”®å‡½æ•°ï¼š

**1.1 parser_expressions_primary.ml - parse_primary_expr (134è¡Œ)**
```ocaml
(* å»ºè®®é‡æ„æ–¹æ¡ˆ *)
- æå– parse_literal_expressions (å¤„ç†å­—é¢é‡)
- æå– parse_type_keyword_expressions (å¤„ç†ç±»å‹å…³é”®å­—)
- æå– parse_compound_expressions (å¤„ç†å¤åˆè¡¨è¾¾å¼)
- æå– parse_keyword_expressions (å¤„ç†å…³é”®å­—è¡¨è¾¾å¼)
- æå– parse_poetry_expressions (å¤„ç†è¯—è¯è¡¨è¾¾å¼)
```

**1.2 parser_statements.ml - parse_statement (104è¡Œ)**
```ocaml
(* å»ºè®®é‡æ„æ–¹æ¡ˆ *)
- æå– parse_let_statement (Letè¯­å¥è§£æ)
- æå– parse_rec_statement (é€’å½’Letè¯­å¥è§£æ)
- æå– parse_exception_statement (å¼‚å¸¸è¯­å¥è§£æ)
- æå– parse_macro_statement (å®è¯­å¥è§£æ)
```

### 2. ä»£ç é‡å¤æ¶ˆé™¤

#### 2.1 åˆ›å»ºç»Ÿä¸€æ ¼å¼åŒ–å·¥å…·æ¨¡å—
```ocaml
(* æ–°å»º src/string_formatting_utils.ml *)
module ErrorFormatting = struct
  let format_error code msg = Printf.sprintf "é”™è¯¯[%s]: %s" code msg
  let format_warning code msg = Printf.sprintf "è­¦å‘Š[%s]: %s" code msg
end

module TypeFormatting = struct
  let format_type_error var expected actual = 
    Printf.sprintf "ç±»å‹é”™è¯¯: å˜é‡'%s'æœŸæœ›ç±»å‹%sï¼Œå®é™…ç±»å‹%s" var expected actual
end
```

#### 2.2 é‡å¤ä½¿ç”¨çƒ­ç‚¹å¤„ç†
- **string_processing_utils.ml**: 22å¤„ â†’ ç»Ÿä¸€åˆ°æ–°çš„æ ¼å¼åŒ–æ¨¡å—
- **types_errors.ml**: 16å¤„ â†’ ä½¿ç”¨ç±»å‹é”™è¯¯æ ¼å¼åŒ–å·¥å…·
- **compiler_errors.ml**: 19å¤„ â†’ ä½¿ç”¨ç¼–è¯‘é”™è¯¯æ ¼å¼åŒ–å·¥å…·

### 3. è¯—è¯ç¼–ç¨‹è‰ºæœ¯æ€§æå‡ (Issue #108)

#### 3.1 æ‰©å±•è¯—è¯æ ¼å¼æ”¯æŒ
```ocaml
(* åœ¨ src/poetry/artistic_evaluation.ml ä¸­æ·»åŠ  *)
type poetry_form =
  | SiYanPianTi    (* å››è¨€éªˆä½“ - å·²æ”¯æŒ *)
  | WuYanLuShi     (* äº”è¨€å¾‹è¯— - å¾…æ‰©å±• *)
  | QiYanJueJu     (* ä¸ƒè¨€ç»å¥ - å¾…æ‰©å±• *)
  | CiPai of string (* è¯ç‰Œæ ¼å¾‹ - æ–°å¢ *)
  | ModernPoetry    (* ç°ä»£è¯— - æ–°å¢ *)
```

#### 3.2 å¢å¼ºè‰ºæœ¯æ€§è¯„ä¼°ç»´åº¦
```ocaml
type advanced_artistic_dimension =
  | ClassicalElegance  (* å¤å…¸é›…è‡´ *)
  | ModernInnovation   (* ç°ä»£åˆ›æ–° *)
  | CulturalDepth      (* æ–‡åŒ–æ·±åº¦ *)
  | EmotionalResonance (* æƒ…æ„Ÿå…±é¸£ *)
  | IntellectualDepth  (* ç†æ€§æ·±åº¦ *)
```

### 4. æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 4.1 ç±»å‹æ¨æ–­ä¼˜åŒ–
```ocaml
(* åœ¨ types_infer.ml ä¸­ *)
- å¢å¼ºç¼“å­˜æœºåˆ¶ï¼Œæé«˜å‘½ä¸­ç‡
- ä½¿ç”¨æ‡’æ±‚å€¼ä¼˜åŒ–é€’å½’ç±»å‹æ¨æ–­
- é¢„è®¡ç®—å¸¸ç”¨ç±»å‹æ¨¡å¼
```

#### 4.2 è§£æå™¨æ€§èƒ½ä¼˜åŒ–
```ocaml
(* åœ¨ parser æ¨¡å—ä¸­ *)
- ä½¿ç”¨æŸ¥æ‰¾è¡¨ä¼˜åŒ–å…³é”®å­—è¯†åˆ«
- é¢„ç¼–è¯‘å¸¸ç”¨è¡¨è¾¾å¼æ¨¡å¼
- å‡å°‘ä¸å¿…è¦çš„å­—ç¬¦ä¸²åˆ†é…
```

## ğŸ“‹ å…·ä½“å®æ–½è®¡åˆ’

### Phase 7A: æ ¸å¿ƒé‡æ„ (ç¬¬1-2å‘¨)

**Week 1: è§£æå™¨é‡æ„**
- [ ] é‡æ„ `parse_primary_expr` â†’ 5ä¸ªå­å‡½æ•°
- [ ] é‡æ„ `parse_statement` â†’ 4ä¸ªå­å‡½æ•°
- [ ] åˆ›å»º `Parser_expressions_helpers.ml` è¾…åŠ©æ¨¡å—
- [ ] åˆ›å»º `Parser_statements_helpers.ml` è¾…åŠ©æ¨¡å—

**Week 2: æ ¼å¼åŒ–ç»Ÿä¸€**
- [ ] åˆ›å»º `String_formatting_utils.ml`
- [ ] è¿ç§»é”™è¯¯æ ¼å¼åŒ–ä»£ç 
- [ ] è¿ç§»ç±»å‹æ ¼å¼åŒ–ä»£ç 
- [ ] æ›´æ–°æ‰€æœ‰è°ƒç”¨ç‚¹

### Phase 7B: è‰ºæœ¯æ€§æå‡ (ç¬¬3-4å‘¨)

**Week 3: è¯—è¯æ ¼å¼æ‰©å±•**
- [ ] å®ç°äº”è¨€å¾‹è¯—æ ¼å¾‹æ£€æŸ¥
- [ ] å®ç°ä¸ƒè¨€ç»å¥æ ¼å¾‹æ£€æŸ¥
- [ ] æ·»åŠ è¯ç‰Œæ ¼å¾‹æ¨¡æ¿ç³»ç»Ÿ
- [ ] æ‰©å±•è‰ºæœ¯æ€§è¯„ä¼°ç»´åº¦

**Week 4: æ€§èƒ½ä¼˜åŒ–**
- [ ] ä¼˜åŒ–ç±»å‹æ¨æ–­ç¼“å­˜
- [ ] ä¼˜åŒ–è§£æå™¨æ€§èƒ½
- [ ] æ·»åŠ æ€§èƒ½æµ‹è¯•ç”¨ä¾‹
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ¨ è‰ºæœ¯æ€§æå‡å…·ä½“æ–¹æ¡ˆ

### äº”è¨€å¾‹è¯—æ”¯æŒ
```ocaml
let wuyan_lushi_pattern = {
  line_count = 8;
  char_per_line = 5;
  rhyme_scheme = [|false; true; false; true; false; true; false; true|];
  parallelism_required = [|false; false; true; true; true; true; false; false|];
  tone_pattern = generate_lushi_tone_pattern 5;
}
```

### ä¸ƒè¨€ç»å¥æ”¯æŒ
```ocaml
let qiyan_jueju_pattern = {
  line_count = 4;
  char_per_line = 7;
  rhyme_scheme = [|false; true; false; true|];
  parallelism_required = [|false; false; true; true|];
  tone_pattern = generate_jueju_tone_pattern 7;
}
```

### ç°ä»£è¯—æ”¯æŒ
```ocaml
let modern_poetry_evaluation = {
  focus_on = [Imagery; EmotionalResonance; IntellectualDepth];
  ignore = [StrictRhyme; StrictTone];
  emphasis = [CreativeExpression; ConceptualDepth];
}
```

## ğŸ” è´¨é‡ä¿è¯æªæ–½

### é‡æ„è´¨é‡æ§åˆ¶
1. **å‡½æ•°è¡Œæ•°é™åˆ¶**: æ¯ä¸ªå‡½æ•°ä¸è¶…è¿‡50è¡Œ
2. **èŒè´£å•ä¸€**: æ¯ä¸ªå‡½æ•°åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„ä»»åŠ¡
3. **æ¥å£ç¨³å®š**: ä¿æŒç°æœ‰å…¬å¼€æ¥å£ä¸å˜
4. **æµ‹è¯•è¦†ç›–**: æ–°ä»£ç æµ‹è¯•è¦†ç›–ç‡â‰¥90%

### ä»£ç å®¡æŸ¥checklist
- [ ] å‡½æ•°å‘½åä½¿ç”¨ä¸­æ–‡ï¼Œè¯­ä¹‰æ¸…æ™°
- [ ] ä»£ç æ³¨é‡Šå®Œæ•´ï¼Œç¬¦åˆä¸­æ–‡ç¼–ç¨‹é£æ ¼
- [ ] æ— ç¡¬ç¼–ç å­—ç¬¦ä¸²ï¼Œä½¿ç”¨å¸¸é‡å®šä¹‰
- [ ] é”™è¯¯å¤„ç†ç»Ÿä¸€ï¼Œä½¿ç”¨æ ‡å‡†æ ¼å¼åŒ–å·¥å…·
- [ ] æ€§èƒ½æ•æ„Ÿè·¯å¾„å·²ä¼˜åŒ–

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### çŸ­æœŸæ•ˆæœ (2å‘¨å)
- ä»£ç å¯ç»´æŠ¤æ€§æå‡40%
- è§£æå™¨æ€§èƒ½æå‡15%
- Printf.sprintfé‡å¤ä½¿ç”¨å‡å°‘50%
- å‡½æ•°å¹³å‡é•¿åº¦å‡å°‘30%

### ä¸­æœŸæ•ˆæœ (4å‘¨å)
- è¯—è¯ç¼–ç¨‹æ ¼å¼æ”¯æŒå¢åŠ 200%
- è‰ºæœ¯æ€§è¯„ä¼°ç»´åº¦ä¸°å¯Œ50%
- ç¼–è¯‘æ€§èƒ½æå‡25%
- ä»£ç è´¨é‡è¯„åˆ†æå‡è‡³90+

### é•¿æœŸæ•ˆæœ (2ä¸ªæœˆå)
- å®Œå…¨å®ç°Issue #108çš„è‰ºæœ¯æ€§ç›®æ ‡
- ä»£ç æ¶æ„ç°ä»£åŒ–ç¨‹åº¦æ˜¾è‘—æå‡
- ä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåšå®åŸºç¡€
- æˆä¸ºä¸­æ–‡ç¼–ç¨‹è¯­è¨€çš„è‰ºæœ¯æ€§æ ‡æ†

## ğŸ¯ æˆåŠŸæ ‡å‡†

### æŠ€æœ¯æŒ‡æ ‡
- [ ] æ— è¶…è¿‡50è¡Œçš„å‡½æ•°
- [ ] Printf.sprintfé‡å¤ä½¿ç”¨<100å¤„
- [ ] æ‰€æœ‰[@warning "-32"]æ ‡è®°éªŒè¯å¹¶æ¸…ç†
- [ ] è¯—è¯ç¼–ç¨‹æ”¯æŒ5ç§ä»¥ä¸Šæ ¼å¼

### è‰ºæœ¯æ€§æŒ‡æ ‡
- [ ] æ”¯æŒå®Œæ•´çš„äº”è¨€å¾‹è¯—åˆ›ä½œ
- [ ] æ”¯æŒå®Œæ•´çš„ä¸ƒè¨€ç»å¥åˆ›ä½œ
- [ ] æä¾›æ™ºèƒ½çš„è¯—è¯è´¨é‡è¯„ä¼°
- [ ] å…·å¤‡ç°ä»£è¯—çš„è‰ºæœ¯æ€§åˆ†æèƒ½åŠ›

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- [ ] ç¼–è¯‘é€Ÿåº¦æå‡25%
- [ ] é”™è¯¯æ¶ˆæ¯æ›´åŠ å‹å¥½å’Œç»Ÿä¸€
- [ ] è¯—è¯ç¼–ç¨‹ä½“éªŒæµç•…è‡ªç„¶
- [ ] æ–‡æ¡£å’Œç¤ºä¾‹å®Œå–„

---

**æ€»ç»“**: é€šè¿‡è¿™ä¸ªç³»ç»Ÿæ€§çš„æ”¹è¿›è®¡åˆ’ï¼Œéª†è¨€é¡¹ç›®å°†åœ¨ä¿æŒå½“å‰ä¼˜ç§€å“è´¨çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥æå‡ä»£ç è´¨é‡å’Œè‰ºæœ¯æ€§è¡¨ç°åŠ›ï¼Œä¸ºä¸­æ–‡ç¼–ç¨‹è¯­è¨€çš„å‘å±•æ ‘ç«‹æ–°çš„æ ‡æ†ã€‚