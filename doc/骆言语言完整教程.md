# 骆言编程语言完整教程

## 目录
1. [语言简介](#语言简介)
2. [下载与安装](#下载与安装)
3. [第一个程序](#第一个程序)
4. [基础语法](#基础语法)
5. [数据类型](#数据类型)
6. [控制结构](#控制结构)
7. [函数定义](#函数定义)
8. [模式匹配](#模式匹配)
9. [高级特性](#高级特性)
10. [中文编程特性](#中文编程特性)
11. [标准库](#标准库)
12. [项目开发](#项目开发)
13. [常见问题](#常见问题)

---

## 语言简介

### 什么是骆言？

骆言（Luoyan）是世界首个**完全自举的中文编程语言**，具备以下特点：

- 🇨🇳 **纯中文语法**：使用中文关键字和标点符号
- 🔄 **完全自举**：编译器本身用骆言编写
- ⚡ **高性能**：编译为C代码，接近原生性能
- 🛠️ **现代特性**：支持函数式、命令式、面向对象编程
- 🎯 **AI友好**：专为AI编程助手优化的语言设计

### 设计理念

骆言旨在创造一个**真正属于中文世界的编程语言**，让中文使用者能够：
- 用母语的思维方式编程
- 享受完整的本土化编程体验
- 构建真正的中文软件生态

---

## 下载与安装

### 系统要求

- **操作系统**：Linux、macOS、Windows (WSL)
- **依赖**：OCaml 4.14+、Dune 3.0+、GCC
- **内存**：最少 2GB RAM
- **存储**：最少 500MB 可用空间

### 快速安装

#### 1. 克隆仓库
```bash
git clone https://github.com/UltimatePea/chinese-ocaml.git
cd chinese-ocaml
```

#### 2. 安装依赖
```bash
# Ubuntu/Debian
sudo apt-get install opam gcc make

# macOS
brew install opam gcc

# 初始化 opam
opam init
eval $(opam env)

# 安装 OCaml 依赖
opam install dune utop uutf
```

#### 3. 构建编译器
```bash
# 构建项目
dune build

# 验证安装
dune exec src/main.exe -- --help
```

#### 4. 验证安装
```bash
# 创建测试文件
echo '让 问候 = "你好，骆言！"
打印 问候' > 测试.ly

# 运行测试
dune exec src/main.exe 测试.ly
```

应该看到输出：
```
你好，骆言！
```

---

## 第一个程序

### Hello World

创建文件 `hello.ly`：

```luoyan
「：我的第一个骆言程序：」
让 问候 = "你好，骆言世界！"
打印 问候
```

运行程序：
```bash
dune exec src/main.exe hello.ly
```

输出：
```
你好，骆言世界！
```

### 程序结构解析

1. **中文注释**：`「：注释内容：」`
2. **变量定义**：`让 变量名 = 值`
3. **函数调用**：`打印 问候`

---

## 基础语法

### 1. 注释语法

骆言支持两种注释方式：

```luoyan
「：这是中文注释语法：」

(* 这是兼容的ASCII注释 *)

「：
多行中文注释
可以包含任意内容
支持中文标点符号（）【】
：」
```

### 2. 变量定义

```luoyan
「：基本数据类型：」
让 整数 = 42
让 浮点数 = 3.14
让 字符串 = "你好世界"
让 布尔值 = 真
让 空值 = 假

「：变量可以重新绑定：」
让 可变值 = 10
让 可变值 = 可变值 + 5    「：现在是 15：」
```

### 3. 表达式

```luoyan
「：数学运算：」
让 加法 = 10 + 5
让 减法 = 10 - 5
让 乘法 = 10 * 5
让 除法 = 10 / 5
让 取模 = 10 % 3

「：比较运算：」
让 等于 = 5 == 5        「：真：」
让 不等于 = 5 != 3      「：真：」
让 大于 = 10 > 5        「：真：」
让 小于等于 = 5 <= 10   「：真：」

「：逻辑运算：」
让 逻辑与 = 真 && 假     「：假：」
让 逻辑或 = 真 || 假     「：真：」
让 逻辑非 = !真          「：假：」
```

---

## 数据类型

### 1. 基本类型

```luoyan
「：整数类型：」
让 正整数 = 42
让 负整数 = -17
让 零 = 0

「：浮点数类型：」
让 圆周率 = 3.14159
让 科学计数法 = 1.23e-4

「：字符串类型：」
让 简单字符串 = "你好"
让 包含引号 = "他说：\"你好\""
让 多行字符串 = "第一行\n第二行"

「：布尔类型：」
让 真值 = 真
让 假值 = 假
```

### 2. 复合类型

#### 列表
```luoyan
「：列表定义：」
让 数字列表 = [1; 2; 3; 4; 5]
让 字符串列表 = ["红"; "绿"; "蓝"]
让 空列表 = []

「：列表操作：」
让 列表头 = 1 :: [2; 3]     「：结果：[1; 2; 3]：」
让 列表连接 = [1; 2] @ [3; 4]  「：结果：[1; 2; 3; 4]：」
```

#### 元组
```luoyan
「：元组定义：」
让 坐标 = (10, 20)
让 三元组 = (1, "hello", 真)
让 嵌套元组 = ((1, 2), (3, 4))

「：元组解构：」
让 (x, y) = 坐标          「：x = 10, y = 20：」
```

### 3. 自定义类型

```luoyan
「：枚举类型：」
类型 颜色 = 红色 | 绿色 | 蓝色 | 黄色

「：带参数的类型：」
类型 形状 = 
  | 圆形 浮点数
  | 矩形 浮点数 浮点数
  | 三角形 浮点数 浮点数 浮点数

「：记录类型：」
类型 人员 = {
  姓名: 字符串;
  年龄: 整数;
  职业: 字符串;
}
```

---

## 控制结构

### 1. 条件语句

```luoyan
「：基本条件语句：」
让 检查年龄 = 函数 年龄 ->
  如果 年龄 >= 18 那么
    "成年人"
  否则
    "未成年人"

「：多重条件：」
让 评估成绩 = 函数 分数 ->
  如果 分数 >= 90 那么
    "优秀"
  否则 如果 分数 >= 80 那么
    "良好"
  否则 如果 分数 >= 60 那么
    "及格"
  否则
    "不及格"
```

### 2. 循环结构

虽然骆言主要推荐函数式编程，但也支持循环：

```luoyan
「：递归实现循环：」
递归 让 重复打印 = 函数 消息 次数 ->
  如果 次数 > 0 那么 (
    打印 消息;
    重复打印 消息 (次数 - 1)
  ) 否则
    ()

「：使用示例：」
重复打印 "你好" 3
```

---

## 函数定义

### 1. 基本函数

```luoyan
「：简单函数：」
让 问候 = 函数 名字 ->
  "你好，" ^ 名字 ^ "！"

「：多参数函数：」
让 加法 = 函数 x y ->
  x + y

「：函数调用：」
让 结果1 = 问候 "张三"        「："你好，张三！"：」
让 结果2 = 加法 10 20         「：30：」
```

### 2. 递归函数

```luoyan
「：阶乘函数：」
递归 让 阶乘 = 函数 n ->
  如果 n <= 1 那么
    1
  否则
    n * 阶乘 (n - 1)

「：斐波那契数列：」
递归 让 斐波那契 = 函数 n ->
  匹配 n 与
  ｜ 0 → 0
  ｜ 1 → 1
  ｜ _ → 斐波那契 (n - 1) + 斐波那契 (n - 2)

「：使用示例：」
让 阶乘5 = 阶乘 5            「：120：」
让 斐波那契10 = 斐波那契 10  「：55：」
```

### 3. 高阶函数

```luoyan
「：函数作为参数：」
让 应用两次 = 函数 f x ->
  f (f x)

让 增加一 = 函数 x -> x + 1
让 结果 = 应用两次 增加一 5   「：7：」

「：返回函数：」
让 创建乘法器 = 函数 倍数 ->
  函数 x -> x * 倍数

让 乘以三 = 创建乘法器 3
让 结果 = 乘以三 10          「：30：」
```

---

## 模式匹配

### 1. 基本模式匹配

```luoyan
「：匹配数值：」
让 描述数字 = 函数 数字 ->
  匹配 数字 与
  ｜ 0 → "零"
  ｜ 1 → "一"
  ｜ 2 → "二"
  ｜ _ → "其他数字"

「：匹配列表：」
让 描述列表 = 函数 列表 ->
  匹配 列表 与
  ｜ [] → "空列表"
  ｜ [x] → "只有一个元素：" ^ (字符串化 x)
  ｜ x :: xs → "首元素是：" ^ (字符串化 x)
```

### 2. 复杂模式匹配

```luoyan
「：匹配自定义类型：」
让 计算面积 = 函数 形状 ->
  匹配 形状 与
  ｜ 圆形 半径 → 3.14 *. 半径 *. 半径
  ｜ 矩形 长 宽 → 长 *. 宽
  ｜ 三角形 底 高 _ → 0.5 *. 底 *. 高

「：匹配元组：」
让 处理坐标 = 函数 坐标 ->
  匹配 坐标 与
  ｜ (0, 0) → "原点"
  ｜ (x, 0) → "在X轴上"
  ｜ (0, y) → "在Y轴上"
  ｜ (x, y) → "普通点(" ^ (字符串化 x) ^ ", " ^ (字符串化 y) ^ ")"
```

### 3. 守卫条件

```luoyan
「：带条件的模式匹配：」
让 分类数字 = 函数 数字 ->
  匹配 数字 与
  ｜ x 当 x > 0 → "正数"
  ｜ x 当 x < 0 → "负数"
  ｜ _ → "零"
```

---

## 高级特性

### 1. 模块系统

```luoyan
「：定义模块：」
模块 数学工具 = {
  让 圆周率 = 3.14159;
  
  让 圆面积 = 函数 半径 ->
    圆周率 *. 半径 *. 半径;
    
  让 圆周长 = 函数 半径 ->
    2.0 *. 圆周率 *. 半径;
}

「：使用模块：」
让 面积 = 数学工具.圆面积 5.0
让 周长 = 数学工具.圆周长 5.0
```

### 2. 异常处理

```luoyan
「：定义异常：」
异常 数学错误 字符串

「：抛出异常：」
让 安全除法 = 函数 x y ->
  如果 y == 0 那么
    抛出 (数学错误 "除零错误")
  否则
    x / y

「：捕获异常：」
让 尝试除法 = 函数 x y ->
  尝试
    安全除法 x y
  捕获
  ｜ 数学错误 消息 → -1
  ｜ _ → -999
```

### 3. 引用和可变性

```luoyan
「：创建引用：」
让 计数器 = 引用 0

「：修改引用：」
计数器 := !计数器 + 1
计数器 := !计数器 + 1

「：读取引用值：」
让 当前值 = !计数器        「：2：」
```

---

## 中文编程特性

### 1. 中文标点符号

骆言支持完整的中文标点符号系统：

```luoyan
「：中文括号：」
让 结果 = （1 + 2） * 3      「：使用全角括号：」

「：中文列表：」
让 颜色列表 = 【"红色"，"绿色"，"蓝色"】   「：目前正在修复中：」

「：中文记录：」
让 学生 = 『姓名："张三"；年龄：20』        「：目前正在修复中：」

「：中文箭头：」
让 函数 = 函数 x → x + 1                   「：目前正在修复中：」

「：中文管道符：」
匹配 值 与
｜ 模式1 → 结果1
｜ 模式2 → 结果2
```

### 2. 自然语言风格编程

```luoyan
「：Wenyan风格语法：」
吾有 一 数 名曰 年龄
设 年龄 为 25 也

吾有 一 术 名曰 问候
欲行 问候 必先得 姓名
為是 乃 曰 "你好，" + 姓名 云云

「：调用示例：」
问候 "李四"
```

### 3. 引用标识符

```luoyan
「：处理关键字冲突：」
让 「让」 = "这是一个变量名"
让 「函数」 = "另一个变量名"
让 「类型」 = "第三个变量名"

「：使用引用标识符：」
让 结果 = 「让」 ^ 「函数」 ^ 「类型」
```

---

## 标准库

### 1. 输入输出

```luoyan
「：控制台操作：」
打印 "请输入您的姓名："
让 姓名 = 读取 ()
打印 ("你好，" ^ 姓名)

「：文件操作：」
让 内容 = "这是要写入的内容"
写入文件 "输出.txt" 内容

让 读取内容 = 读取文件 "输出.txt"
打印 读取内容
```

### 2. 列表操作

```luoyan
「：常用列表函数：」
让 数字 = [1; 2; 3; 4; 5]

让 长度值 = 长度 数字                    「：5：」
让 双倍 = 映射 (函数 x -> x * 2) 数字    「：[2; 4; 6; 8; 10]：」
让 偶数 = 过滤 (函数 x -> x % 2 == 0) 数字 「：[2; 4]：」
让 总和 = 折叠 (+) 0 数字                「：15：」

「：列表生成：」
让 范围 = 范围 1 10                     「：[1; 2; 3; 4; 5; 6; 7; 8; 9; 10]：」
让 排序后 = 排序 [3; 1; 4; 1; 5]        「：[1; 1; 3; 4; 5]：」
让 反转后 = 反转 [1; 2; 3]              「：[3; 2; 1]：」
```

### 3. 字符串操作

```luoyan
「：字符串函数：」
让 文本 = "你好，世界"

让 长度 = 字符串长度 文本               「：5：」
让 连接 = 字符串连接 "你好" "世界"      「："你好世界"：」
让 分割 = 字符串分割 "a,b,c" ","        「：["a"; "b"; "c"]：」

「：大小写转换：」
让 大写 = 大写转换 "hello"              「："HELLO"：」
让 小写 = 小写转换 "WORLD"              「："world"：」

「：字符串处理：」
让 去空白 = 去除空白 "  你好  "          「："你好"：」
让 替换 = 字符串替换 "你好世界" "世界" "骆言" 「："你好骆言"：」
```

### 4. 数学函数

```luoyan
「：基础数学：」
让 绝对值结果 = 绝对值 (-5)             「：5：」
让 平方结果 = 平方 4                   「：16：」
让 平方根结果 = 平方根 16.0             「：4.0：」

「：高级数学：」
让 幂运算结果 = 幂运算 2.0 3.0          「：8.0：」
让 对数结果 = 对数 100.0               「：2.0：」
让 正弦值 = 正弦 (3.14159 /. 2.0)      「：1.0：」

「：随机数：」
让 随机值 = 随机数 1 100               「：1到100之间的随机数：」
```

---

## 项目开发

### 1. 项目结构

典型的骆言项目结构：

```
我的项目/
├── 源码/
│   ├── 主程序.ly
│   ├── 工具.ly
│   └── 数据.ly
├── 测试/
│   ├── 主程序测试.ly
│   └── 工具测试.ly
├── 文档/
│   └── README.md
└── dune-project
```

### 2. 构建配置

创建 `dune-project`：
```dune
(lang dune 3.0)
(package
 (name 我的项目)
 (depends ocaml dune))
```

创建 `源码/dune`：
```dune
(executable
 (public_name 我的项目)
 (name 主程序)
 (libraries yyocamlc_lib))
```

### 3. 模块化开发

**工具.ly**：
```luoyan
「：工具模块：」
让 调试 = 函数 消息 ->
  打印 ("[调试] " ^ 消息)

让 格式化时间 = 函数 时间戳 ->
  「：这里可以添加时间格式化逻辑：」
  "2025-07-13 12:00:00"

「：导出函数：」
```

**主程序.ly**：
```luoyan
「：导入工具模块：」
「：使用 工具.调试 和 工具.格式化时间：」

让 主函数 = 函数 () ->
  调试 "程序开始运行";
  让 当前时间 = 格式化时间 0 在
  打印 ("当前时间：" ^ 当前时间);
  调试 "程序运行完成"

「：程序入口：」
主函数 ()
```

### 4. 测试编写

**测试/主程序测试.ly**：
```luoyan
「：测试框架：」
让 断言 = 函数 条件 消息 ->
  如果 条件 那么
    打印 ("✓ " ^ 消息)
  否则 (
    打印 ("✗ " ^ 消息);
    exit 1
  )

「：测试用例：」
让 测试加法 = 函数 () ->
  断言 (2 + 3 == 5) "加法测试";
  断言 (10 - 5 == 5) "减法测试"

「：运行测试：」
测试加法 ()
打印 "所有测试通过！"
```

---

## 常见问题

### Q1: 如何处理编译错误？

**A**: 使用详细模式查看错误信息：
```bash
dune exec src/main.exe -- -v 文件.ly
```

常见错误类型：
- **词法错误**：检查字符编码和特殊字符
- **语法错误**：检查括号匹配和关键字拼写
- **类型错误**：检查变量定义和函数调用

### Q2: 中文标点符号不工作怎么办？

**A**: 确保使用正确的中文标点符号：
- ✅ 正确：`（）` `【】` `『』` `：` `，` `；` `｜` `→`
- ❌ 错误：`()` `[]` `{}` `:` `,` `;` `|` `->`

当前部分中文标点存在问题，建议混合使用：
```luoyan
「：注释使用中文：」
让 变量 = (表达式)    「：括号暂时用ASCII：」
匹配 值 与           「：匹配可以用中文：」
｜ 模式 → 结果        「：管道符和箭头部分支持：」
```

### Q3: 如何提高程序性能？

**A**: 
1. **使用尾递归**：避免栈溢出
2. **编译到C**：使用 `-c` 选项生成C代码
3. **优化算法**：选择合适的数据结构和算法

```luoyan
「：尾递归优化示例：」
递归 让 尾递归阶乘 = 函数 n 累计 ->
  如果 n <= 1 那么
    累计
  否则
    尾递归阶乘 (n - 1) (n * 累计)

让 阶乘 = 函数 n -> 尾递归阶乘 n 1
```

### Q4: 如何调试程序？

**A**: 使用打印调试和断言：
```luoyan
「：调试技巧：」
让 调试打印 = 函数 变量名 值 ->
  打印 (变量名 ^ " = " ^ (字符串化 值))

让 断言等于 = 函数 实际值 期望值 ->
  如果 实际值 != 期望值 那么 (
    打印 ("断言失败：期望 " ^ (字符串化 期望值) ^ "，实际 " ^ (字符串化 实际值));
    exit 1
  ) 否则
    打印 "断言通过"
```

### Q5: 如何贡献到骆言项目？

**A**: 
1. Fork GitHub仓库
2. 创建功能分支
3. 编写测试用例
4. 提交Pull Request
5. 参与代码审查

---

## 结语

骆言编程语言代表了中文编程的新里程碑。通过学习本教程，您已经掌握了：

- ✅ 基础语法和数据类型
- ✅ 函数式编程技巧
- ✅ 模式匹配和类型系统
- ✅ 中文编程特性
- ✅ 项目开发最佳实践

### 下一步学习

1. **深入研究**：阅读[语言设计文档](design/)
2. **实践项目**：查看[示例程序](../示例/)
3. **参与社区**：在GitHub上提问和讨论
4. **贡献代码**：帮助完善骆言生态

### 联系我们

- 🌐 **官方仓库**：https://github.com/UltimatePea/chinese-ocaml
- 📚 **文档中心**：[doc/](../doc/)
- 🐛 **问题报告**：[GitHub Issues](https://github.com/UltimatePea/chinese-ocaml/issues)
- 💬 **讨论交流**：[GitHub Discussions](https://github.com/UltimatePea/chinese-ocaml/discussions)

---

**骆言编程语言** - 让编程回归中文思维  
© 2025 骆言项目组  
文档版本：v2.1  
更新日期：2025年7月13日

「：感谢选择骆言，祝您编程愉快！：」