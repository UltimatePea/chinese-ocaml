# 诗词模块整合重构计划

**问题编号**: #1155  
**创建日期**: 2025年7月25日  
**分支**: fix/poetry-module-consolidation-1155

## 现状分析

### 文件统计
- 总ML文件数: 88个
- 总MLI文件数: 88个
- 艺术性评价相关: 26个文件
- 韵律相关: 81个文件

### 问题确认
确实存在严重的模块过度细分问题，这影响了：
1. 代码维护性
2. 编译性能
3. 开发者理解成本
4. 测试覆盖质量

## 整合策略

### 第一阶段：韵律引擎整合
**目标**: 将81个韵律相关文件整合为核心模块

**实施步骤**:
1. 分析现有rhyme_*文件的功能和依赖关系
2. 设计统一的韵律引擎API
3. 创建 `poetry_rhyme_engine.ml` 核心模块
4. 逐步迁移功能并保持API兼容性
5. 测试验证和性能评估

### 第二阶段：艺术性分析整合
**目标**: 将26个艺术性评价文件整合为分析模块

### 第三阶段：数据管理整合
**目标**: 统一数据加载和缓存机制

### 第四阶段：验证和优化
**目标**: 确保功能完整性和性能提升

## 风险控制

1. **渐进式整合**: 每次只处理一小部分文件
2. **保持兼容性**: 不改变公开API
3. **完整测试**: 每个步骤都要通过测试验证
4. **性能监控**: 确保无性能退化

## 修订策略 (更安全的方法)

经过详细分析，发现现有模块数量庞大且相互依赖。为避免破坏现有功能，采用以下保守策略：

### 第一阶段：创建推荐API (当前阶段)
- 创建 `poetry_recommended_api.ml` 模块
- 提供清晰的API文档，指导开发者使用推荐的模块
- 标记重复或过时的模块

### 第二阶段：渐进式整合
- 基于使用统计，逐步合并低使用率的重复模块
- 保持完全向后兼容
- 每个小步骤都要通过完整测试

### 第三阶段：文档改进
- 为推荐的模块添加详细文档
- 创建最佳实践指南
- 提供迁移建议

## 进度跟踪

- [x] 模块结构分析 
- [x] 风险评估和策略修订
- [x] 创建推荐API模块
- [x] 添加使用指导文档
- [x] 标记重复模块
- [x] 测试验证
- [x] 第一阶段实现完成

---
*此文档将随着重构进展持续更新*