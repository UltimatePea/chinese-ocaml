# 骆言语法规范

## 词法结构

### 关键字
| 中文关键字 | 英文对应 | 用途 |
|------------|----------|------|
| 让 | let | 变量绑定 |
| 递归 | rec | 递归定义 |
| 在 | in | let表达式中的作用域 |
| 函数 | fun | 函数定义 |
| 如果 | if | 条件判断 |
| 那么 | then | 条件真分支 |
| 否则 | else | 条件假分支 |
| 匹配 | match | 模式匹配 |
| 与 | with | 模式匹配分支 |
| 类型 | type | 类型定义 |
| 真 | true | 布尔真值 |
| 假 | false | 布尔假值 |
| 并且 | and | 逻辑与 |
| 或者 | or | 逻辑或 |
| 非 | not | 逻辑非 |

### 运算符
| 运算符 | 类型 | 描述 |
|--------|------|------|
| + | 算术 | 加法 |
| - | 算术 | 减法/负号 |
| * | 算术 | 乘法 |
| / | 算术 | 除法 |
| % | 算术 | 取模 |
| == | 比较 | 相等 |
| <> | 比较 | 不等 |
| < | 比较 | 小于 |
| <= | 比较 | 小于等于 |
| > | 比较 | 大于 |
| >= | 比较 | 大于等于 |
| -> | 函数 | 函数类型/匿名函数 |
| => | 宏 | 宏展开 |

### 分隔符
| 分隔符 | 用途 |
|--------|------|
| ( ) | 分组、元组 |
| [ ] | 列表 |
| { } | 记录、代码块 |
| , | 分隔元素 |
| ; | 分隔语句/列表元素 |
| : | 类型注解 |
| \| | 模式匹配分支、变体类型 |
| _ | 通配符模式 |

## 类型系统

### 基础类型
```
整数类型: int
浮点类型: float
字符串类型: string
布尔类型: bool
单元类型: unit
```

### 复合类型
```
函数类型: type1 -> type2
元组类型: type1 * type2 * ...
列表类型: type list
构造类型: CustomType of type1 * type2
```

### 类型定义
```ocaml
类型 颜色 = 红色 | 绿色 | 蓝色
类型 坐标 = { x: int; y: int }
类型 'a 选项 = 无 | 有 of 'a
```

## 表达式语法

### 字面量
```ocaml
42          // 整数
3.14        // 浮点数
"你好"       // 字符串
真          // 布尔值true
假          // 布尔值false
()          // 单元值
```

### 变量和绑定
```ocaml
让 x = 42
让 f = 函数 a -> a + 1
让 递归 阶乘 = 函数 n ->
  如果 n <= 1 那么 1 否则 n * 阶乘 (n - 1)
```

### 函数调用
```ocaml
f x
阶乘 5
打印 "hello"
```

### 条件表达式
```ocaml
如果 x > 0 那么 "正数" 否则 "非正数"
```

### 模式匹配
```ocaml
匹配 值 与
| 0 -> "零"
| 1 -> "一"
| _ -> "其他"
```

### 列表操作
```ocaml
[1; 2; 3]           // 列表字面量
头部 :: 尾部         // 列表构造
匹配 列表 与
| [] -> "空列表"
| 头 :: 尾 -> "非空列表"
```

## 语句语法

### 表达式语句
```ocaml
表达式;
```

### 变量绑定语句
```ocaml
让 变量名 = 表达式;
让 递归 函数名 = 函数表达式;
```

### 类型定义语句
```ocaml
类型 类型名 = 类型定义;
```

### 模块定义
```ocaml
模块 模块名 = {
  // 模块内容
};
```

## 模式匹配详解

### 基本模式
- 通配符: `_`
- 变量: `x`
- 字面量: `42`, `"hello"`, `真`
- 构造器: `Some x`, `None`

### 复合模式
- 元组: `(x, y)`
- 列表: `[x; y; z]`
- 列表构造: `头 :: 尾`
- 空列表: `[]`
- 选择模式: `模式1 | 模式2`

## 异步编程语法

### 异步函数
```ocaml
异步 函数 名称 参数 -> 表达式
```

### 等待操作
```ocaml
等待 异步表达式
```

### 并发操作
```ocaml
启动 异步表达式
```

## 宏系统语法

### 宏定义
```ocaml
宏 宏名(参数1, 参数2) =>
  宏体表达式
```

### 宏调用
```ocaml
宏名!(参数1, 参数2)
```

## 注释语法
```ocaml
// 单行注释

(*
   多行注释
   可以嵌套
*)
```

这个语法规范定义了骆言语言的完整语法结构，为编译器实现和用户编程提供了标准参考。