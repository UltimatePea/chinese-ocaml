# RFC 0041: 中文符号替换方案

## 概述

根据 Issue #41 的要求，本提案详细规划将骆言编程语言中的特殊符号（除标点符号外）全部替换为具有中文风味的自然语言表达，以提升语言的中文化程度和可读性。

## 背景

目前骆言语言使用了大量符号，如 `【】`、`[|`、`|]`、`{}`等。为了更好地体现中文编程的特色，我们希望将这些符号替换为更具中文风味的表达方式。

### 保留的符号

根据要求，以下符号将继续保留：
- 中文标点符号：`，`、`。`、`「`、`『`、`』`、`」`、`（`、`）`

## 替换方案

### 1. 列表语法替换

#### 当前语法
```
【1，2，3】
```

#### 建议替换方案A：简洁式
```
列开始
1 其一
2 其二  
3 其三
列结束
```

#### 建议替换方案B：自然语言式
```
有列名甲 其中元素有三
其一为 1
其二为 2
其三为 3
以上三元素为列甲
```

#### 建议替换方案C：混合式（推荐）
```
列开始 1，2，3 列结束
```

### 2. 数组语法替换

#### 当前语法
```
[| 1; 2; 3 |]
```

#### 建议替换方案
```
数组开始 1，2，3 数组结束
```

### 3. 记录语法替换

#### 当前语法
```
{ 姓名 = \"张三\"; 年龄 = 25 }
```

#### 建议替换方案
```
记录开始
姓名为 \"张三\"，
年龄为 25
记录结束
```

### 4. 模式匹配语法替换

#### 当前语法
```
match x with
| 1 -> \"一\"
| 2 -> \"二\"
| _ -> \"其他\"
```

#### 建议替换方案
```
匹配 x 的情况
若为 1 则返回 \"一\"
若为 2 则返回 \"二\"
否则返回 \"其他\"
匹配结束
```

### 5. 函数定义语法替换

#### 当前语法
```
let 加法 = fun x y -> x + y
```

#### 建议替换方案
```
定义函数 加法 参数为 x 和 y
函数体开始
返回 x + y
函数体结束
```

### 6. 类型定义语法替换

#### 当前语法
```
type 颜色 = 红色 | 绿色 | 蓝色
```

#### 建议替换方案
```
定义类型 颜色 包含以下选项
选项 红色
选项 绿色  
选项 蓝色
类型定义结束
```

### 7. 模块语法替换

#### 当前语法
```
module 数学 = struct
  let 加法 x y = x + y
end
```

#### 建议替换方案
```
模块 数学 开始
定义 加法 参数 x 和 y 为 x + y
模块结束
```

## 实施计划

### 阶段1：核心语法替换（2周）
1. 更新词法分析器，添加新的中文关键字
2. 更新语法分析器，支持新语法
3. 保持向后兼容（临时）

### 阶段2：测试和验证（1周）
1. 更新所有测试用例
2. 验证编译器功能完整性
3. 性能测试

### 阶段3：文档和示例更新（1周）
1. 更新语言参考手册
2. 更新所有示例文件
3. 创建迁移指南

### 阶段4：移除旧语法（1周）
1. 完全移除符号语法支持
2. 最终测试和验证

## 技术实现

### 词法分析器更新
需要在 `src/lexer.ml` 中添加以下新关键字：
- `列开始`、`列结束`
- `数组开始`、`数组结束`
- `记录开始`、`记录结束`
- `匹配`、`的情况`、`若为`、`则返回`、`否则返回`、`匹配结束`
- `定义函数`、`参数为`、`函数体开始`、`函数体结束`
- `定义类型`、`包含以下选项`、`选项`、`类型定义结束`
- `模块`、`开始`、`结束`

### 语法分析器更新
更新 `src/parser.ml` 中的语法规则，支持新的中文自然语言语法。

### AST保持不变
抽象语法树结构保持不变，只是解析路径不同。

## 优缺点分析

### 优点
1. **中文化程度高**：完全符合中文编程的理念
2. **可读性强**：自然语言更容易理解
3. **教学友好**：特别适合中文编程教学
4. **独特性**：区别于其他编程语言的特色

### 缺点
1. **代码冗长**：相比符号语法更加冗长
2. **输入效率**：可能影响编程效率
3. **习惯转换**：需要开发者适应新语法

## 迁移策略

### 自动迁移工具
可以考虑创建一个自动迁移工具，将现有的符号语法转换为新的中文语法：

```bash
骆言编译器 --迁移 旧文件.ly 新文件.ly
```

### 分步迁移
1. 首先在新功能中使用新语法
2. 逐步迁移核心库
3. 最后迁移示例和测试

## 示例对比

### 旧语法示例
```ocaml
let 快速排序 = fun 列表 ->
  match 列表 with
  | [] -> []
  | x :: xs ->
    let 小于等于 = List.filter (fun y -> y <= x) xs in
    let 大于 = List.filter (fun y -> y > x) xs in
    快速排序 小于等于 @ [x] @ 快速排序 大于
```

### 新语法示例
```
定义函数 快速排序 参数为 列表
函数体开始
匹配 列表 的情况
若为 空列表 则返回 空列表
若为 x 加上 xs 则
  定义 小于等于 为 从 xs 中筛选 满足条件 y <= x 的元素
  定义 大于 为 从 xs 中筛选 满足条件 y > x 的元素
  返回 连接 快速排序 小于等于，列表 x，快速排序 大于
匹配结束
函数体结束
```

## 征求意见

请项目维护者 @UltimatePea 审阅此方案并提供反馈：

1. **替换方案选择**：您更倾向于哪种风格的替换？
2. **实施优先级**：应该优先实施哪些语法的替换？
3. **兼容性期间**：是否需要保持短期的向后兼容？
4. **性能考量**：对解析性能是否有特殊要求？

## 相关Issue

- Issue #41: 请撰写一个提案：唯一希望出现的符号是，。「『』」（） 其他符号请全部换成中文
- Issue #42: 解决#41之后，希望将项目中所有的骆言原文件全部替换成中文

---

**状态**：待审阅  
**类型**：语法变更提案  
**影响范围**：所有语法结构  
**预计实施周期**：4-5周