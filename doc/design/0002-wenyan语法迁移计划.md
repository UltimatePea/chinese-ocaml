# Wenyan语法迁移计划 (RFC 0002)

**日期**: 2025-07-12
**状态**: 设计中
**响应**: GitHub Issue #24

## 概述

参考wenyan-lang项目的语法设计，逐步将骆言编程语言的语法迁移为更符合中文表达习惯的形式。

## 当前语法 vs Wenyan语法对比

### 变量声明

| 功能 | 当前骆言 | Wenyan-lang | 建议迁移 |
|------|----------|-------------|----------|
| 数字 | `让 甲 = 3` | `吾有一數。曰三。名之曰「甲」。` | `吾有一数。曰三。名之曰「甲」。` |
| 字符串 | `让 乙 = "hello"` | `吾有一言。曰「「hello」」。名之曰「乙」。` | `吾有一言。曰「「hello」」。名之曰「乙」。` |
| 布尔 | `让 丙 = 真` | `吾有一爻。曰陽。名之曰「丙」。` | `吾有一爻。曰阳。名之曰「丙」。` |
| 数组 | `让 丁 = []` | `吾有一列。名之曰「丁」。` | `吾有一列。名之曰「丁」。` |

### 函数定义

| 功能 | 当前骆言 | Wenyan-lang | 建议迁移 |
|------|----------|-------------|----------|
| 函数定义 | `函数 加法 x y = x + y` | `吾有一術。名之曰「加法」。欲行是術。必先得二數。曰「甲」「乙」。是術曰。加「甲」以「乙」。乃得其數也。是謂「加法」之術也。` | 简化版：`有术名曰「加法」。欲行此术，必先得二数。曰「甲」「乙」。术曰：加甲以乙。乃得其数。术毕。` |

### 控制流

| 功能 | 当前骆言 | Wenyan-lang | 建议迁移 |
|------|----------|-------------|----------|
| 条件语句 | `如果 条件 那么 ... 否则 ...` | `若 條件 者。... 若非。... 也。` | `若 条件 者。... 若非。... 也。` |
| 循环 | `重复 100 次 ...` | `為是百遍。... 云云。` | `为是百遍。... 云云。` |
| 遍历 | `对于 x 在 列表 ...` | `凡「列表」中之「元素」。... 云云。` | `凡「列表」中之「元素」。... 云云。` |

## 迁移阶段规划

### 第一阶段：基础语法扩展
1. **变量声明关键字**
   - 添加 `吾有一数`、`吾有一言`、`吾有一爻`、`吾有一列`
   - 添加 `名之曰`、`曰` 等关键字
   - 支持传统数字（一、二、三...）

2. **新增token类型**
   ```ocaml
   | IHaveKeyword        (* 吾有 *)
   | OneKeyword          (* 一 *)
   | NumberTypeKeyword   (* 数 *)
   | StringTypeKeyword   (* 言 *)
   | BoolTypeKeyword     (* 爻 *)
   | ArrayTypeKeyword    (* 列 *)
   | NameItKeyword       (* 名之曰 *)
   | SayKeyword          (* 曰 *)
   ```

### 第二阶段：控制流扩展
1. **条件语句**
   - `若...者` 替代 `如果...那么`
   - `若非` 替代 `否则`
   - `也` 作为结束标记

2. **循环语句**
   - `为是...遍` 替代 `重复...次`
   - `云云` 作为循环体结束标记
   - `凡...中之...` 遍历语法

### 第三阶段：函数和高级特性
1. **函数定义**
   - `有术名曰` 定义函数
   - `欲行此术，必先得` 参数声明
   - `术曰` 开始函数体
   - `乃得` 返回值
   - `术毕` 结束函数

2. **数学运算**
   - `加...以...` 替代 `+ `
   - `减...以...` 替代 `-`
   - `乘...以...` 替代 `*`
   - `除...以...` 替代 `/`

## 实现策略

### 渐进式迁移
1. **双语法支持期**：同时支持现有语法和wenyan语法
2. **过渡期**：优先推荐wenyan语法，现有语法标记为deprecated
3. **完全迁移期**：移除旧语法支持

### 语法优先级
- 「」引用标识符：最高优先级，已实现
- wenyan关键字：次高优先级，需要实现
- 传统关键字：兼容性支持

## 技术实现考虑

### 词法分析器更新
1. 扩展关键字表，添加wenyan关键字
2. 支持中文传统数字（一、二、三...）
3. 处理更复杂的语法结构

### 语法分析器更新
1. 添加wenyan语法的解析规则
2. 支持更灵活的语句结构
3. 处理文言文风格的语法特征

### 向后兼容性
- 第一阶段保持完全向后兼容
- 提供迁移工具协助代码转换
- 详细的迁移指南和文档

## 优先级建议

1. **高优先级**：基础变量声明语法 (`吾有一数` 等)
2. **中优先级**：控制流语法 (`若...者` 等)
3. **低优先级**：函数定义和数学运算语法

## 预期效果

1. **提高语言的中文特色**：更符合中文表达习惯
2. **增强可读性**：文言文风格提高代码的文学性
3. **保持实用性**：在美观和实用之间找到平衡
4. **AI友好**：更自然的中文表达有利于AI理解和编写

---

*参考资料：*
- wenyan-lang项目：https://github.com/wenyan-lang/wenyan
- wenyan-lang语法手册：https://github.com/wenyan-lang/wenyan/wiki/Syntax-Cheatsheet

*🤖 Generated by Claude*