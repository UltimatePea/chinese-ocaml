# 0040-中文标点符号实施计划

## 概述

根据Issue #39的要求，需要移除所有ASCII符号并使用中文标点符号，以实现完全中文化的编程语言。本文档详细规划了实施策略和具体的符号映射关系。

## 背景

当前骆言编程语言使用了大量ASCII符号，包括括号、箭头、冒号等。为了实现真正的中文编程体验，需要将这些符号替换为中文标点符号，参考wenyan-lang项目的做法。

## 符号映射表

### 1. 括号类符号

| 当前符号 | 中文替代 | Token名称 | 用途说明 |
|----------|----------|-----------|----------|
| `(` | `（` | ChineseLeftParen | 函数调用、表达式分组 |
| `)` | `）` | ChineseRightParen | 函数调用、表达式分组 |
| `[` | `【` | ChineseLeftBracket | 列表字面量 |
| `]` | `】` | ChineseRightBracket | 列表字面量 |
| `{` | `『` | ChineseLeftBrace | 记录字面量 |
| `}` | `』` | ChineseRightBrace | 记录字面量 |
| `[|` | `【｜` | ChineseLeftArray | 数组字面量 |
| `|]` | `｜】` | ChineseRightArray | 数组字面量 |

**注意**：`「」` (U+300C/U+300D) 保留用于引用标识符，如 `「变量名」`，不用于列表语法。

### 2. 箭头类符号

| 当前符号 | 中文替代 | Token名称 | 用途说明 |
|----------|----------|-----------|----------|
| `->` | `→` | ChineseArrow | 函数类型、模式匹配 |
| `=>` | `⇒` | ChineseDoubleArrow | 异常处理 |
| `<-` | `←` | ChineseAssignArrow | 数组赋值 |

### 3. 标点符号

| 当前符号 | 中文替代 | Token名称 | 用途说明 |
|----------|----------|-----------|----------|
| `:` | `：` | ChineseColon | 类型注解 |
| `,` | `，` | ChineseComma | 参数分隔 |
| `;` | `；` | ChineseSemicolon | 语句分隔 |
| `|` | `｜` | ChinesePipe | 模式匹配、类型定义 |

### 4. 运算符保持

以下符号在中文编程中较为通用，暂时保持不变：

| 符号 | 说明 |
|------|------|
| `.` | 点操作符（字段访问） |
| `..` | 范围操作符 |
| `...` | 展开操作符 |
| `=` | 赋值操作符 |
| `==` | 相等比较 |
| `<>` | 不等比较 |
| `<`, `<=`, `>`, `>=` | 数值比较 |
| `!` | 解引用操作符 |
| `:=` | 引用赋值 |
| `#` | 方法调用 |
| `_` | 通配符模式 |

### 5. 注释语法

根据Issue #39建议，注释使用：`「：注释内容：」`

## 实施策略

### 阶段1：词法分析器更新

1. **更新lexer.ml**：
   - 修改正则表达式以识别中文标点符号
   - 保持向后兼容性（可选）
   - 更新token定义

2. **测试词法分析**：
   - 创建包含中文标点的测试用例
   - 验证token生成正确性

### 阶段2：语法分析器适配

1. **更新parser.ml**：
   - 语法规则保持不变，只需确保新token被正确处理
   - 更新错误消息以使用中文标点

2. **语法测试**：
   - 更新现有测试用例
   - 创建新的中文标点测试

### 阶段3：示例和文档更新

1. **更新示例文件**：
   - 将所有示例代码改为使用中文标点
   - 确保功能正确性

2. **更新文档**：
   - 修改语法说明文档
   - 更新语言参考手册

### 阶段4：向后兼容性处理

考虑是否需要：
- 同时支持ASCII和中文标点
- 提供迁移工具
- 逐步废弃ASCII符号

## 技术实施细节

### 词法分析器修改要点

```ocaml
(* 示例：中文括号识别 *)
let chinese_punctuation = [
  ('（', LeftParen);
  ('）', RightParen);
  ('「', LeftBracket);
  ('」', RightBracket);
  ('『', LeftBrace);
  ('』', RightBrace);
  ('：', Colon);
  ('，', Comma);
  ('；', Semicolon);
  ('｜', Pipe);
]
```

### UTF-8处理注意事项

- 确保正确处理多字节UTF-8字符
- 注意字符边界判断
- 保持解析性能

## 测试策略

### 1. 单元测试
- 词法分析器token生成测试
- 语法分析器解析测试
- 错误处理测试

### 2. 集成测试
- 端到端编译测试
- 代码生成验证
- 运行时行为测试

### 3. 兼容性测试
- 与现有代码的兼容性
- 性能回归测试

## 风险评估

### 高风险项
- UTF-8字符处理可能影响性能
- 现有代码需要大量修改
- 字符显示兼容性问题

### 缓解措施
- 分阶段实施，逐步验证
- 保持详细的测试覆盖
- 提供清晰的迁移指南

## 时间表

- **第1周**：词法分析器实施和测试
- **第2周**：语法分析器适配和验证
- **第3周**：示例代码更新和测试
- **第4周**：文档更新和最终验证

## 结论

通过系统性地替换ASCII符号为中文标点符号，骆言编程语言将实现真正的中文编程体验。本实施计划提供了详细的技术路线图，确保变更的安全性和可靠性。

---

**状态**：设计完成，待实施  
**相关Issue**：#39  
**预计完成时间**：4周  
**影响范围**：词法分析器、语法分析器、所有示例代码