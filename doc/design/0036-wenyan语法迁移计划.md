# 骆言语法迁移计划：向文言文风格演进

## 概述

基于GitHub issue #24的要求，我们需要研究wenyan-lang的语法设计，并将骆言的语法迁移到更加中文化、更接近古典中文表达的风格。本文档详细规划了这个迁移过程。

## wenyan-lang语法特点分析

### wenyan-lang的核心设计理念
1. **模仿古典中文语法** - 使用传统中文的语言结构
2. **可选标点符号** - 像古文一样，标点和换行是可选的
3. **文学化编程** - 代码读起来像古典文学作品
4. **传统汉字** - 使用繁体字符

### wenyan-lang典型语法模式
```wenyan
吾有一數。曰三。名之曰「甲」。    // 变量声明
為是「甲」遍。                    // 循环
吾有一言。曰「「問天地好在。」」。書之。  // 输出
```

## 骆言当前语法状态

### 现有中文关键字体系
骆言已经拥有相当完善的中文关键字系统：

#### 核心语言结构
- `让` (let) - 变量绑定
- `递归` (rec) - 递归定义
- `在` (in) - 作用域
- `函数` (fun) - 函数定义
- `如果`/`那么`/`否则` - 条件语句
- `匹配`/`与` - 模式匹配

#### 数据类型和值
- `类型` (type) - 类型定义
- `真`/`假` - 布尔值
- `并且`/`或者`/`非` - 逻辑运算

#### 面向对象
- `类`/`继承`/`方法`/`新建`/`自己` - 面向对象编程

## 迁移计划

### 阶段一：变量声明语法中文化

#### 当前语法
```luoyan
让 数值 = 42
让 结果 = 计算函数 数值
```

#### 目标语法（wenyan风格）
```luoyan
吾有一数，名曰「数值」，其值四十二也。
吾有一值，名曰「结果」，乃计算函数以数值得也。
```

或者简化版本：
```luoyan
设数值为四十二。
设结果为计算函数数值。
```

#### 实现要点
1. 新增关键字：`吾有`、`名曰`、`其值`、`也`、`乃`、`设`、`为`
2. 支持更自然的中文语序
3. 保持与现有语法的兼容性

### 阶段二：函数定义中文化

#### 当前语法
```luoyan
递归 让 阶乘 = 函数 数值 ->
  如果 数值 == 0 那么 1 否则 数值 * 阶乘 (数值 - 1)
```

#### 目标语法
```luoyan
定函数名曰「阶乘」，受一参名曰「数值」：
  若数值等于零，则返一；
  否则返数值乘以阶乘之数值减一。
```

或者：
```luoyan
阶乘之法：受数值。
  数值若为零，则得一；
  否则得数值乘阶乘之数值减一也。
```

#### 实现要点
1. 新增关键字：`定函数`、`受`、`参`、`若`、`则`、`返`、`之法`、`得`
2. 支持更自然的条件表达语法
3. 函数调用语法的中文化

### 阶段三：控制流中文化

#### 当前模式匹配语法
```luoyan
匹配 列表 与
| [] -> "空列表"
| [head; ...tail] -> "非空列表"
```

#### 目标语法
```luoyan
观列表之形：
  若为空，则曰「空列表」；
  若有首尾，则曰「非空列表」。
```

### 阶段四：更多语言结构的中文化

#### 循环结构
```luoyan
// 当前（需要新增）
为数值次循环：
  打印 数值

// wenyan风格
為是数值遍，行：
  書数值。
```

#### 模块系统
```luoyan
// 当前
模块 数学 = { ... }

// 目标
建模块名曰「数学」：
  ...
毕。
```

## 实施策略

### 渐进式迁移
1. **保持向后兼容** - 新语法作为当前语法的补充，不破坏现有代码
2. **逐步引入** - 先实现核心语法，再扩展到高级特性
3. **测试驱动** - 每个新语法都要有完整的测试用例

### 技术实现路径
1. **词法分析器扩展** - 在lexer.ml中添加新的关键字
2. **语法分析器更新** - 在parser.ml中添加新的语法规则
3. **AST兼容** - 确保新语法映射到现有AST节点
4. **测试验证** - 创建全面的测试套件

### 用户体验考虑
1. **可选性** - 用户可以选择使用传统语法或新的中文化语法
2. **混合使用** - 在同一程序中可以混合使用两种语法风格
3. **工具支持** - 语法高亮、错误提示等都要支持新语法

## 预期效果

### 代码示例对比

#### 传统骆言语法
```luoyan
递归 让 快速排序 = 函数 列表 ->
  匹配 列表 与
  | [] -> []
  | [pivot; ...rest] ->
    让 smaller = 过滤 (函数 x -> x <= pivot) rest 在
    让 larger = 过滤 (函数 x -> x > pivot) rest 在
    快速排序 smaller @ [pivot] @ 快速排序 larger
```

#### 新的中文化语法
```luoyan
快速排序之法：受列表。
  观列表之形：
    若为空，则得空列表；
    若有首为基准、余为其余，则：
      设较小者为过滤其余中不大于基准者；
      设较大者为过滤其余中大于基准者；
      得快速排序较小者连基准连快速排序较大者。
```

### 优势
1. **更符合中文思维** - 语法结构更接近中文表达习惯
2. **增强可读性** - 代码更像自然语言描述
3. **文化特色** - 体现中华文化在编程语言中的表达
4. **AI友好** - 更自然的表达方式有利于AI理解和生成

## 风险评估

### 潜在挑战
1. **复杂性增加** - 需要维护两套语法系统
2. **学习成本** - 用户需要学习新的语法风格
3. **工具适配** - IDE和工具需要适配新语法

### 缓解措施
1. **充分测试** - 确保新语法的稳定性和可靠性
2. **渐进推出** - 分阶段引入，给用户适应时间
3. **完善文档** - 提供详细的语法指南和迁移指南

## 下一步行动

1. **实现阶段一** - 先实现变量声明的中文化语法
2. **验证可行性** - 通过测试确保新语法可以正常工作
3. **收集反馈** - 根据使用情况调整设计
4. **继续迭代** - 逐步实现后续阶段的功能

这个迁移计划将使骆言成为一个真正具有中华文化特色的编程语言，在保持技术先进性的同时，体现深厚的文化底蕴。