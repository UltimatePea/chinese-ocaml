# 骆言项目技术债务立即行动项

**日期**: 2025年7月15日  
**基于**: 技术债务全面分析报告  
**紧急程度**: 高优先级项目

## 立即可执行的改进项（本周内）

### 1. 清理调试文件和临时代码 ⚡

**可以立即执行，无风险**

```bash
# 删除所有调试文件
rm -rf debug/

# 删除备份文件
rm src/parser.ml.backup

# 查找并删除其他临时文件
find . -name "*.disabled" -delete
find . -name "*.backup" -delete
```

**预期收益**:
- 减少项目复杂度
- 清理代码库结构
- 减少50+个不必要文件

### 2. 移除生产代码中的调试输出 🔧

**文件**: `src/codegen.ml`, `src/main.ml`

**问题**: 存在`print_endline`调用在生产代码中

**操作**:
- 将调试输出改为使用Logger模块
- 或者完全移除临时打印语句

### 3. 处理TODO注释 📝

**文件**: `src/ai/ai_code_generator.ml:280`

**当前代码**:
```ocaml
Printf.sprintf "让 「%s」 = 函数 参数 →\n  (* TODO: 实现 %s *)\n  参数"
```

**建议操作**:
- 实现该功能，或
- 转换为GitHub issue跟踪

## 中期改进项（2-4周内）

### 4. 创建核心模块接口文件 📋

**必需的.mli文件**:
- `src/parser.mli` - 最重要
- `src/lexer.mli` - 次重要  
- `src/types.mli` - 重要
- `src/semantic.mli` - 重要

**实施策略**:
- 从最小接口开始
- 逐步扩展公共API
- 确保不破坏现有功能

### 5. 重新启用关键测试 🧪

**优先级顺序**:

1. **arrays测试** - 修复中文数字解析
   ```dune
   ; temporarily disabled due to Chinese digit parsing issues
   ```

2. **type_definitions测试** - 修复符号限制问题
   ```dune  
   ; temporarily disabled due to issue #105 symbol restrictions
   ```

3. **records测试** - 修复记录类型支持

**每个测试修复步骤**:
1. 取消注释测试配置
2. 运行测试查看具体错误
3. 修复根本问题
4. 验证测试通过

## 长期改进项（1-2个月）

### 6. 大文件拆分 📊

**拆分优先级**:

1. **parser.ml** (1871行) - 最紧急
   - 表达式解析 → `expression_parser.ml`
   - 语句解析 → `statement_parser.ml`
   - 类型解析 → `type_parser.ml`

2. **codegen.ml** (1583行) - 次紧急
   - OCaml生成 → `ocaml_codegen.ml`
   - 工具函数 → `codegen_utils.ml`

3. **lexer.ml** (1520行) - 重要
   - 中文处理 → `chinese_lexer.ml`
   - 词法规则 → `lexer_rules.ml`

### 7. 统一错误处理 ⚠️

**现状问题**:
- 5种不同的异常类型
- 8处低质量`raise (Failure ...)`
- 错误信息不一致

**目标**:
- 创建统一错误类型系统
- 实现结构化错误信息
- 添加错误恢复机制

## 实施建议

### 本周行动计划
1. 周一-周二：执行立即行动项（1-3）
2. 周三-周四：开始接口文件创建（项目4）
3. 周五：测试重新启用准备工作（项目5）

### 风险缓解
- 每项更改前创建分支
- 每项更改后运行测试
- 保持详细的更改日志

### 质量检查
- 所有更改必须保持编译通过
- 现有功能不能被破坏
- 遵循项目编码规范

## 预期收益时间线

### 1周后
- 项目整洁度提升30%
- 编译时间缩短10%
- 开发者体验改善

### 1个月后  
- 代码可维护性提升60%
- 测试覆盖率从50%提升到70%
- 新功能开发效率提升40%

### 3个月后
- 完全模块化的代码库
- 完整的测试覆盖
- 优秀的代码质量指标

## 总结

通过优先处理风险低、收益高的改进项，我们可以快速改善项目的技术债务状况。建议立即开始执行前3个行动项，它们可以在不影响功能的情况下显著改善代码库质量。

**下一步**: 获得维护者同意后，立即开始执行清理工作。